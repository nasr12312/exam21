<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ù†Ø¨Ø±Ø§Ø³ | Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  :root {
    --primary: #4f46e5;
    --secondary: #64748b;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --dark: #1e293b;
    --light: #f8fafc;
  }
  body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; min-height: 100vh; overflow-x: hidden; }
  
  /* Sidebar */
  .sidebar {
    width: 260px; height: 100vh; position: fixed; right: 0; top: 0;
    background: var(--dark); color: white; transition: 0.3s; z-index: 1000;
    padding-top: 20px;
  }
  .sidebar-header { padding: 0 20px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; text-align: center; }
  .logo-img { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px; border: 3px solid var(--warning); }
  
  .nav-link {
    color: #94a3b8; padding: 12px 20px; display: flex; align-items: center; gap: 12px;
    font-weight: 500; transition: 0.3s; border-radius: 8px; margin: 0 10px 5px; cursor: pointer;
  }
  .nav-link:hover, .nav-link.active { background: var(--primary); color: white; transform: translateX(-5px); }
  .nav-link i { width: 20px; text-align: center; }

  /* Main Content */
  .main-content { margin-right: 260px; padding: 30px; transition: 0.3s; }
  
  /* Cards */
  .stat-card {
    background: white; border-radius: 16px; padding: 25px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: none;
    position: relative; overflow: hidden; height: 100%;
  }
  .stat-card::after {
    content: ''; position: absolute; top: 0; right: 0; width: 4px; height: 100%;
  }
  .stat-card.blue::after { background: var(--primary); }
  .stat-card.green::after { background: var(--success); }
  .stat-card.orange::after { background: var(--warning); }
  
  .stat-icon {
    width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center;
    justify-content: center; font-size: 24px; margin-bottom: 15px;
  }
  .bg-soft-blue { background: #e0e7ff; color: var(--primary); }
  .bg-soft-green { background: #d1fae5; color: var(--success); }
  .bg-soft-orange { background: #fef3c7; color: var(--warning); }

  /* Tables */
  .custom-table { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
  .custom-table th { background: #f8fafc; color: var(--secondary); font-weight: 700; padding: 15px; border-bottom: 2px solid #e2e8f0; }
  .custom-table td { padding: 15px; vertical-align: middle; color: var(--dark); border-bottom: 1px solid #f1f5f9; }

  /* Forms */
  .form-control, .form-select {
    padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0;
    box-shadow: none; font-size: 14px;
  }
  .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
  .btn-primary { background: var(--primary); border: none; padding: 10px 20px; border-radius: 10px; font-weight: 600; }
  .btn-primary:hover { background: #4338ca; }

  /* ID Card Printing Styling - Professional A4 */
  #print-area { display: none; }
  
  @media print {
    body { background: white; -webkit-print-color-adjust: exact; }
    .sidebar, .no-print, .header-area, .btn { display: none !important; }
    .main-content { margin: 0; padding: 0; width: 100%; }
    #print-area { 
      display: grid !important; 
      grid-template-columns: repeat(2, 1fr); /* Ø¨Ø·Ø§Ù‚ØªÙŠÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¶ */
      gap: 15px; 
      padding: 20px;
    }
    .id-card-print {
      border: 1px solid #000;
      border-radius: 10px;
      padding: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
      page-break-inside: avoid;
      background: white;
      height: 180px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
    }
    .id-photo { width: 100px; height: 100px; object-fit: cover; border: 2px solid #333; }
    .id-info { flex: 1; text-align: right; }
    .id-qr { width: 90px; height: 90px; }
  }

  @media (max-width: 992px) {
    .sidebar { transform: translateX(100%); }
    .sidebar.active { transform: translateX(0); }
    .main-content { margin-right: 0; }
  }
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <img src="https://i.ibb.co/VrJsk41/Gemini-Generated-Image-u0u4kwu0u4kwu0u4.png" class="logo-img">
    <h4 class="mb-0 fw-bold">Ù…Ù†ØµØ© Ù†Ø¨Ø±Ø§Ø³</h4>
    <small class="text-white-50">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© V3.0</small>
  </div>
  <div class="nav flex-column">
    <div class="nav-link active" onclick="showTab('home', this)"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-link" onclick="showTab('students', this)"><i class="fas fa-users"></i> Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</div>
    <div class="nav-link" onclick="showTab('results', this)"><i class="fas fa-chart-bar"></i> Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
    <div class="nav-link" onclick="showTab('library', this)"><i class="fas fa-book"></i> Ø§Ù„Ù…ÙƒØªØ¨Ø©</div>
    <div class="nav-link" onclick="showTab('assign', this)"><i class="fas fa-tasks"></i> Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</div>
    <div class="nav-link" onclick="showTab('complaints', this)"><i class="fas fa-envelope"></i> Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</div>
    <div class="nav-link" onclick="showTab('settings', this)"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  </div>
</div>

<div class="main-content">
  <div class="d-flex justify-content-between align-items-center mb-4 header-area no-print">
    <div>
      <h3 class="fw-bold text-dark mb-1">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</h3>
      <p class="text-muted mb-0">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ©</p>
    </div>
    <div class="d-flex gap-2">
      <button onclick="location.reload()" class="btn btn-light"><i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«</button>
      <button class="btn btn-primary d-lg-none" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    </div>
  </div>

  <div id="tab-home" class="section-tab">
    <div class="row g-4 mb-4 no-print">
      <div class="col-md-4">
        <div class="stat-card blue">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
              <h2 class="fw-bold mb-0" id="s-cnt">-</h2>
            </div>
            <div class="stat-icon bg-soft-blue"><i class="fas fa-user-graduate"></i></div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card green">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted mb-1">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</p>
              <h2 class="fw-bold mb-0" id="e-cnt">-</h2>
            </div>
            <div class="stat-icon bg-soft-green"><i class="fas fa-file-alt"></i></div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card orange">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <p class="text-muted mb-1">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ØªÙˆÙØ±Ø©</p>
              <h2 class="fw-bold mb-0" id="c-cnt">-</h2>
            </div>
            <div class="stat-icon bg-soft-orange"><i class="fas fa-barcode"></i></div>
          </div>
        </div>
      </div>
    </div>

    <div class="row no-print">
      <div class="col-md-8 mb-4">
        <div class="card border-0 shadow-sm p-4 h-100">
          <h5 class="fw-bold mb-3"><i class="fas fa-plus-circle text-primary"></i> ØªÙˆÙ„ÙŠØ¯ Ø£ÙƒÙˆØ§Ø¯ ØªÙØ¹ÙŠÙ„</h5>
          <div class="row g-3">
             <div class="col-md-6"><input id="gen-count" type="number" class="form-control" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯"></div>
             <div class="col-md-6"><input id="gen-cls" class="form-control" placeholder="Ø§Ù„ØµÙ (Ù…Ø«Ø§Ù„: Ø§Ù„ØªØ§Ø³Ø¹ Ø£)"></div>
             
             <div class="col-md-6">
                <label class="small text-muted mb-1">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                <select id="gen-type" class="form-select">
                    <option value="Full">Ø§Ø´ØªØ±Ø§Ùƒ ÙƒØ§Ù…Ù„ (Ù…Ø¯ÙÙˆØ¹)</option>
                    <option value="Trial">ØªØ¬Ø±ÙŠØ¨ÙŠ (Ù…Ø¬Ø§Ù†ÙŠ)</option>
                </select>
             </div>
             <div class="col-md-6">
                <label class="small text-muted mb-1">Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£ÙŠØ§Ù…</label>
                <input id="gen-dur" type="number" class="form-control" placeholder="Ù…Ø«Ù„Ø§Ù‹: 120" value="120">
             </div>
             
             <div class="col-md-12"><button onclick="generate()" class="btn btn-primary w-100">ØªÙˆÙ„ÙŠØ¯ ÙˆØ­ÙØ¸</button></div>
          </div>
          <hr class="my-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
             <h6 class="fw-bold m-0">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h6>
             <div class="d-flex gap-2">
               <select id="f-cls" class="form-select form-select-sm" style="width:120px" onchange="render()"><option value="all">ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option></select>
               <select id="f-sts" class="form-select form-select-sm" style="width:120px" onchange="render()"><option value="New">Ø¬Ø¯ÙŠØ¯Ø©</option><option value="Used">Ù…Ø³ØªØ®Ø¯Ù…Ø©</option><option value="all">Ø§Ù„ÙƒÙ„</option></select>
               <button onclick="deleteUsedCodes()" class="btn btn-sm btn-outline-danger">ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
               <button onclick="printCodes()" class="btn btn-sm btn-outline-dark"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
             </div>
          </div>
          <div id="code-container" style="max-height:400px; overflow-y:auto; display:grid; grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); gap:10px"></div>
        </div>
      </div>
      
      <div class="col-md-4 mb-4">
        <div class="card border-0 shadow-sm p-4 h-100 bg-dark text-white" style="background: linear-gradient(135deg, #1e293b, #0f172a);">
           <h5 class="fw-bold mb-3"><i class="fas fa-paper-plane text-warning"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±</h5>
           <p class="text-white-50">Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø·Ù„Ø§Ø¨ Ø¹Ø¨Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</p>
           
           <label class="mb-2">Ø§Ù„Ù…Ø³ØªÙ„Ù…ÙˆÙ†:</label>
           <select id="msg-target" class="form-select mb-2 bg-white text-dark border-0">
             <option value="All">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</option>
             </select>
           
           <label class="mb-2">Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„ Ù„Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¯Ø¯ (Ø§Ù„Ø¨Ø±ÙŠØ¯):</label>
           <input id="msg-email-manual" class="form-control mb-3 bg-white text-dark border-0" placeholder="example@gmail.com">
           
           <label class="mb-2">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
           <textarea id="msg-text" class="form-control mb-3" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
           
           <button onclick="sendMsg()" class="btn btn-warning w-100 fw-bold">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±</button>
        </div>
      </div>
    </div>
  </div>

  <div id="tab-students" class="section-tab d-none">
     <div class="d-flex justify-content-between align-items-center mb-3 no-print">
        <h4 class="fw-bold">Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h4>
        <button onclick="printCards()" class="btn btn-success"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (A4)</button>
     </div>
     
     <div class="card p-3 mb-4 no-print">
        <div class="row g-2">
            <div class="col-md-4"><input id="m-email" class="form-control" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"></div>
            <div class="col-md-3"><input id="m-pass" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©"></div>
            <div class="col-md-2"><button onclick="resetPass()" class="btn btn-warning w-100">ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³</button></div>
            <div class="col-md-2"><button onclick="delStudent()" class="btn btn-danger w-100">Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button></div>
        </div>
     </div>

     <div id="ids-grid" class="row g-3 no-print"></div>
  </div>

  <div id="tab-results" class="section-tab d-none">
     <div class="d-flex justify-content-between align-items-center mb-3 no-print">
        <h4 class="fw-bold">Ø³Ø¬Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h4>
        <div class="d-flex gap-2">
           <input type="text" id="res-search" class="form-control" placeholder="Ø¨Ø­Ø«..." onkeyup="filterResults()">
           <select id="res-cls-filter" class="form-select" onchange="filterResults()"><option value="all">Ø§Ù„ÙƒÙ„</option></select>
           <button onclick="exportToExcel()" class="btn btn-success text-nowrap"><i class="fas fa-file-excel"></i> Ø§ÙƒØ³Ù„</button>
        </div>
     </div>
     <div class="custom-table">
        <table class="table table-hover mb-0" id="res-table">
           <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
           <tbody id="res-body"></tbody>
        </table>
     </div>
  </div>

  <div id="tab-library" class="section-tab d-none">
     <div class="row">
       <div class="col-md-4">
         <div class="card p-4 border-0 shadow-sm">
            <h5 class="fw-bold mb-3">Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰</h5>
            <input id="lib-title" class="form-control mb-2" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³">
            <select id="lib-type" class="form-select mb-2"><option value="PDF">Ù…Ù„Ù PDF</option><option value="Video">ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨</option></select>
            <input id="lib-cls" class="form-control mb-2" placeholder="Ø§Ù„ØµÙ (Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„ÙƒÙ„)">
            <input id="lib-link" class="form-control mb-3" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±">
            <button onclick="addLib()" class="btn btn-primary w-100">Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
         </div>
       </div>
       <div class="col-md-8">
         <div class="custom-table">
           <table class="table mb-0">
             <thead><tr><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØµÙ</th><th>Ø­Ø°Ù</th></tr></thead>
             <tbody id="lib-body"></tbody>
           </table>
         </div>
       </div>
     </div>
  </div>

  <div id="tab-assign" class="section-tab d-none">
     <div class="custom-table">
        <table class="table table-hover mb-0">
           <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ù„Ù</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø­ÙØ¸</th></tr></thead>
           <tbody id="ass-body"></tbody>
        </table>
     </div>
  </div>

  <div id="tab-complaints" class="section-tab d-none">
     <div class="custom-table">
        <table class="table mb-0">
           <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th><th>Ø§Ù„Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</th></tr></thead>
           <tbody id="comp-body"></tbody>
        </table>
     </div>
  </div>

  <div id="tab-settings" class="section-tab d-none">
    <div class="row g-4">
      <div class="col-md-6">
        <div class="card p-4 border-0 shadow-sm">
          <h5 class="fw-bold mb-3"><i class="fas fa-user-cog text-primary"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆØ§Ù„Ù…Ù†ØµØ©</h5>
          <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©):</label>
          <input id="sett-name" class="form-control mb-3" placeholder="Ø£. ÙÙ„Ø§Ù† Ø§Ù„ÙÙ„Ø§Ù†ÙŠ">
          <label class="form-label">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø´Ø®ØµÙŠ:</label>
          <input id="sett-wa" class="form-control mb-3" placeholder="00962...">
          <label class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØµØ©:</label>
          <select id="sett-maint" class="form-select mb-3">
             <option value="Off">ğŸŸ¢ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ</option>
             <option value="On">ğŸ”´ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© (Ù…ØºÙ„Ù‚Ø©)</option>
          </select>
          <button onclick="saveSettings()" class="btn btn-primary w-100">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>
      </div>
      <div class="col-md-6">
         <div class="card p-4 border-0 shadow-sm">
            <h5 class="fw-bold mb-3"><i class="fas fa-share-alt text-primary"></i> Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</h5>
            <div class="mb-3">
               <label><i class="fab fa-whatsapp text-success"></i> Ø±Ø§Ø¨Ø· Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</label>
               <input id="social-whatsapp" class="form-control" placeholder="https://chat.whatsapp.com/...">
            </div>
            <div class="mb-3">
               <label><i class="fab fa-facebook text-primary"></i> ØµÙØ­Ø© Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ:</label>
               <input id="social-facebook" class="form-control" placeholder="https://facebook.com/...">
            </div>
            <div class="mb-3">
               <label><i class="fab fa-instagram text-danger"></i> Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…:</label>
               <input id="social-instagram" class="form-control" placeholder="https://instagram.com/...">
            </div>
            <div class="mb-3">
               <label><i class="fab fa-youtube text-danger"></i> ÙŠÙˆØªÙŠÙˆØ¨:</label>
               <input id="social-youtube" class="form-control" placeholder="https://youtube.com/...">
            </div>
            <button onclick="saveSocialLinks()" class="btn btn-success w-100">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
         </div>
      </div>
    </div>
    
    <div class="row g-4 mt-2">
      <div class="col-12">
        <div class="card p-4 border-0 shadow-sm border-start border-danger border-5">
          <h5 class="fw-bold text-danger mb-3"><i class="fas fa-exclamation-triangle"></i> Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© (Ø­Ø°Ù ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡)</h5>
          <p class="text-muted">ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø³ÙŠÙ‚ÙˆÙ… Ø¨Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙˆØ¥Ø¹Ø§Ø¯ØªÙ‡Ø§ Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…ØµÙ†Ø¹. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ©.</p>
          
          <div class="row" id="tables-checklist">
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Students" id="chk-std"><label class="form-check-label" for="chk-std">Ø§Ù„Ø·Ù„Ø§Ø¨ (Students)</label></div></div>
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Exams" id="chk-exm"><label class="form-check-label" for="chk-exm">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª (Exams)</label></div></div>
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Questions" id="chk-ques"><label class="form-check-label" for="chk-ques">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Questions)</label></div></div>
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Results" id="chk-res"><label class="form-check-label" for="chk-res">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Results)</label></div></div>
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Codes" id="chk-cod"><label class="form-check-label" for="chk-cod">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Codes)</label></div></div>
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Assignments" id="chk-ass"><label class="form-check-label" for="chk-ass">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª (Assignments)</label></div></div>
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Library" id="chk-lib"><label class="form-check-label" for="chk-lib">Ø§Ù„Ù…ÙƒØªØ¨Ø© (Library)</label></div></div>
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Complaints" id="chk-com"><label class="form-check-label" for="chk-com">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ (Complaints)</label></div></div>
             <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Notifications" id="chk-not"><label class="form-check-label" for="chk-not">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Notifications)</label></div></div>
          </div>
          
          <div class="mt-4">
            <button onclick="performReset()" class="btn btn-danger fw-bold"><i class="fas fa-trash-alt"></i> ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<div id="print-area"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ===========================================
// âš ï¸ Ù‡Ø§Ù…: Ø¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§
const API_URL = "https://script.google.com/macros/s/AKfycbyfF_pkwka9-aTWrJme-tzqnEstDabGYg1XrQF7TGvhoo8f48asvUjeSC1AOWFflcv5/exec"; 
// ===========================================

let allData=[], allResults=[], allStudents=[];

window.onload = function() { loadAllData(); };

async function callApi(action, data = {}) {
    data.action = action;
    try {
        const response = await fetch(API_URL, { method: 'POST', body: JSON.stringify(data) });
        return await response.json();
    } catch (e) { 
        Swal.fire('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±', 'error');
        return {success: false}; 
    }
}

function loadAllData() {
    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„', allowOutsideClick: false, didOpen: () => Swal.showLoading()});
    callApi('getAdminData').then(data => {
        Swal.close();
        init(data);
    });
}

function init(data) {
  allData = data.codes;
  document.getElementById('s-cnt').innerText = data.stats.students;
  document.getElementById('e-cnt').innerText = data.stats.exams;
  document.getElementById('c-cnt').innerText = data.stats.codes;

  // Settings Fill
  if(data.settings) {
      if(data.settings['TeacherName']) document.getElementById('sett-name').value = data.settings['TeacherName'];
      if(data.settings['WhatsApp']) document.getElementById('sett-wa').value = data.settings['WhatsApp'];
      if(data.settings['Maintenance']) document.getElementById('sett-maint').value = data.settings['Maintenance'];
  }
  if(data.socials) {
      document.getElementById('social-facebook').value = data.socials.facebook || '';
      document.getElementById('social-instagram').value = data.socials.instagram || '';
      document.getElementById('social-whatsapp').value = data.socials.whatsapp || '';
      document.getElementById('social-youtube').value = data.socials.youtube || '';
  }

  // Populate Classes for Filter & Message Target
  let classes = [...new Set(allData.map(i=>i.cls).filter(c => c && c.trim() !== ""))];
  
  // ØªØ¹Ø¨Ø¦Ø© ÙÙ„ØªØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙˆÙÙ„ØªØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  ['f-cls', 'res-cls-filter'].forEach(id => {
      let sel = document.getElementById(id);
      sel.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option>';
      classes.forEach(c => { let o = document.createElement('option'); o.value = c; o.innerText = c; sel.appendChild(o); });
  });

  // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  let msgSel = document.getElementById('msg-target');
  msgSel.innerHTML = '<option value="All">Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</option>';
  classes.forEach(c => {
      let o = document.createElement('option'); o.value = c; o.innerText = "Ø·Ù„Ø§Ø¨ " + c; msgSel.appendChild(o);
  });

  render();
}

function showTab(tabId, el) {
    document.querySelectorAll('.section-tab').forEach(d => d.classList.add('d-none'));
    document.getElementById('tab-'+tabId).classList.remove('d-none');
    document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
    el.classList.add('active');
    
    // Load specific data on tab switch
    if(tabId === 'students') loadIds();
    if(tabId === 'results') loadResults();
    if(tabId === 'library') loadLibrary();
    if(tabId === 'assign') loadAssign();
    if(tabId === 'complaints') loadComp();
    
    // On mobile, hide sidebar after click
    if(window.innerWidth < 992) document.getElementById('sidebar').classList.remove('active');
}

function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

// --- Codes ---
function render() {
  let cls = document.getElementById('f-cls').value;
  let sts = document.getElementById('f-sts').value;
  let filtered = allData.filter(c => (cls=='all'||c.cls==cls) && (sts=='all'||c.status==sts));
  let h = '';
  filtered.forEach(c => {
    // âœ… Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ø¯Ø¬ Ù„ØªÙˆØ¶ÙŠØ­ Ù†ÙˆØ¹ Ø§Ù„ÙƒÙˆØ¯ (ØªØ¬Ø±ÙŠØ¨ÙŠ Ø£Ùˆ ÙƒØ§Ù…Ù„)
    let typeBadge = c.type === 'Trial' ? '<span class="badge bg-warning text-dark">ØªØ¬Ø±ÙŠØ¨ÙŠ</span>' : '<span class="badge bg-primary">ÙƒØ§Ù…Ù„</span>';
    h += `<div style="background:white; border:1px solid #e2e8f0; padding:10px; border-radius:8px; text-align:center;">
            <div class="fw-bold small text-muted">${c.cls}</div>
            <div class="fw-bold fs-5 my-1" style="letter-spacing:2px">${c.code}</div>
            <div class="d-flex justify-content-center gap-1 mt-1">
                <span class="badge ${c.status=='New'?'bg-success':'bg-secondary'}">${c.status=='New'?'Ø¬Ø¯ÙŠØ¯':'Ù…Ø³ØªØ®Ø¯Ù…'}</span>
                ${typeBadge}
            </div>
          </div>`;
  });
  document.getElementById('code-container').innerHTML = h || '<div class="text-center w-100 text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</div>';
}

function generate() {
  let count = document.getElementById('gen-count').value;
  let cls = document.getElementById('gen-cls').value;
  // âœ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ù…Ø¯Ø©
  let type = document.getElementById('gen-type').value;
  let dur = document.getElementById('gen-dur').value;

  if(!count || !cls || !dur) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
  
  callApi('generateNewCodes', {count:count, cls:cls, type:type, duration:dur})
    .then(res => { 
        Swal.fire('ØªÙ…', res, 'success'); 
        setTimeout(location.reload, 1500); 
    });
}

function deleteUsedCodes(){
   Swal.fire({title:'ØªØ£ÙƒÙŠØ¯ØŸ', text:'Ø­Ø°Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©ØŸ', icon:'warning', showCancelButton:true}).then(r=>{
       if(r.isConfirmed) callApi('deleteUsedCodes').then(res => Swal.fire('ØªÙ…', res, 'success'));
   });
}

// --- Messaging ---
function sendMsg() {
  let manualEmail = document.getElementById('msg-email-manual').value;
  let target = manualEmail ? manualEmail.trim() : document.getElementById('msg-target').value;
  let m = document.getElementById('msg-text').value;
  
  if(!m) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'warning');
  
  callApi('sendTargetedMessage', {target:target, msg:m}).then(res => {
      Swal.fire('ØªÙ…', 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      document.getElementById('msg-text').value = '';
      document.getElementById('msg-email-manual').value = '';
  });
}

// --- Students & Cards Printing ---
function loadIds() {
    document.getElementById('ids-grid').innerHTML = '<div class="text-center w-100"><i class="fas fa-spinner fa-spin fa-2x text-primary"></i></div>';
    callApi('getStudentsForCards').then(list => {
        allStudents = list;
        let h = '';
        if(!list || list.length === 0) h = '<div class="alert alert-info w-100">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯</div>';
        else list.forEach(s => {
            let qr = 'https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=' + encodeURIComponent(s.email);
            h += `<div class="col-md-4 col-lg-3">
                    <div class="card p-3 shadow-sm text-center h-100 position-relative">
                        <img src="${s.photo||'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'}" style="width:70px;height:70px;border-radius:50%;margin:0 auto;object-fit:cover;border:2px solid var(--primary)">
                        <h6 class="mt-2 fw-bold mb-1">${s.name}</h6>
                        <span class="badge bg-soft-blue text-primary mb-2">${s.cls}</span>
                        <div class="mt-auto"><img src="${qr}" style="width:80px"></div>
                        <div class="small text-muted mt-1" style="font-size:10px">${s.email}</div>
                    </div>
                  </div>`;
        });
        document.getElementById('ids-grid').innerHTML = h;
    });
}

// Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø´ÙƒÙ„ Ø§Ø­ØªØ±Ø§ÙÙŠ A4
function printCards() {
    if(!allStudents.length) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©', 'info');
    
    let h = '';
    allStudents.forEach(s => {
        let qr = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=' + encodeURIComponent(s.email);
        h += `<div class="id-card-print">
                 <img src="${s.photo||'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'}" class="id-photo">
                 <div class="id-info">
                    <h3 style="margin:0; font-weight:bold; color:#000;">${s.name}</h3>
                    <p style="margin:5px 0; font-size:18px;">Ø§Ù„ØµÙ: ${s.cls}</p>
                    <p style="margin:0; font-size:12px; color:#555;">${s.email}</p>
                 </div>
                 <img src="${qr}" class="id-qr">
              </div>`;
    });
    
    document.getElementById('print-area').innerHTML = h;
    window.print();
}

function printCodes() {
   let content = document.getElementById('code-container').innerHTML;
   let win = window.open('', '', 'height=700,width=900');
   win.document.write('<html><head><title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</title>');
   win.document.write('<style>body{font-family:sans-serif; direction:rtl} .grid{display:grid; grid-template-columns:repeat(4, 1fr); gap:10px} div{border:1px solid #000; padding:10px; text-align:center}</style>');
   win.document.write('</head><body>');
   win.document.write('<div class="grid">' + content + '</div>');
   win.document.write('</body></html>');
   win.document.close();
   win.print();
}

// --- Other Logic ---
function resetPass(){ let e = document.getElementById('m-email').value, p = document.getElementById('m-pass').value; if(!e || !p) return Swal.fire('Ù†Ù‚Øµ', 'Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©', 'warning'); callApi('adminResetPass', {email:e, newPass:p}).then(res => Swal.fire('ØªÙ…', res, 'success')); }
function delStudent(){ let e = document.getElementById('m-email').value; if(!e) return; Swal.fire({title:'Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ', icon:'warning', showCancelButton:true}).then(r=>{ if(r.isConfirmed) callApi('deleteStudent', {email:e}).then(res => Swal.fire('ØªÙ…', res, 'success')); }); }

function loadResults() { callApi('getAllResultsForAdmin').then(data => { allResults = data; renderResults(data); }); }
function renderResults(data) {
    let tbody = document.getElementById('res-body');
    if(!data.length) { tbody.innerHTML = '<tr><td colspan="6" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>'; return; }
    let h = '';
    data.forEach(r => {
        h += `<tr><td>${r.date}</td><td class="fw-bold">${r.name}</td><td>${r.cls}</td><td>${r.exam}</td><td><span class="badge ${parseInt(r.score)>=50?'bg-success':'bg-danger'}">${r.score}</span></td><td><button class="btn btn-sm btn-outline-danger" onclick="deleteRes(${r.rowId})"><i class="fas fa-trash"></i></button></td></tr>`;
    });
    tbody.innerHTML = h;
}
function filterResults() {
    let q = document.getElementById('res-search').value.toLowerCase();
    let cls = document.getElementById('res-cls-filter').value;
    let filtered = allResults.filter(r => (r.name.toLowerCase().includes(q) || r.exam.toLowerCase().includes(q)) && (cls === 'all' || r.cls === cls));
    renderResults(filtered);
}
function deleteRes(rowId) { Swal.fire({title:'Ø­Ø°Ù Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŸ', icon:'warning', showCancelButton:true}).then(r=>{ if(r.isConfirmed) callApi('deleteResultRow', {rowId:rowId}).then(msg => { loadResults(); }); }); }
function exportToExcel() {
    let csv = "\uFEFFØ§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ø·Ø§Ù„Ø¨,Ø§Ù„ØµÙ,Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†,Ø§Ù„Ø¯Ø±Ø¬Ø©\n";
    allResults.forEach(r => { csv += `${r.date},${r.name},${r.cls},${r.exam},${r.score}\n`; });
    let link = document.createElement("a"); link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv); link.download = "Ø§Ù„Ù†ØªØ§Ø¦Ø¬.csv"; link.click();
}

function loadLibrary() {
    callApi('getLibraryForAdmin').then(list => {
        let h = '';
        list.forEach(i => {
            h += `<tr><td>${i.title}</td><td>${i.type}</td><td>${i.cls||'Ø§Ù„ÙƒÙ„'}</td><td><button class="btn btn-sm btn-danger" onclick="delLib(${i.rowId})"><i class="fas fa-trash"></i></button></td></tr>`;
        });
        document.getElementById('lib-body').innerHTML = h || '<tr><td colspan="4" class="text-center text-muted">Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙØ§Ø±ØºØ©</td></tr>';
    });
}
function addLib() {
    let d = { title: document.getElementById('lib-title').value, type: document.getElementById('lib-type').value, cls: document.getElementById('lib-cls').value, link: document.getElementById('lib-link').value };
    if(!d.title || !d.link) return Swal.fire('Ù†Ù‚Øµ', 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
    callApi('addToLibrary', {d:d}).then(r=>{ Swal.fire('ØªÙ…', r, 'success'); loadLibrary(); });
}
function delLib(id) { if(confirm('Ø­Ø°ÙØŸ')) callApi('deleteLibraryItem', {rowId:id}).then(r=>{ loadLibrary(); }); }

function loadAssign() {
    callApi('getAssignmentsForAdmin').then(list => {
        let h = '';
        list.forEach(i => {
            h += `<tr><td>${i.date}</td><td>${i.name}</td><td>${i.type}</td><td><a href="${i.link}" target="_blank" class="btn btn-sm btn-primary">Ø¹Ø±Ø¶</a></td><td><input id="g-${i.rowId}" value="${i.grade}" style="width:60px" class="form-control form-control-sm"></td><td><button onclick="saveGrade(${i.rowId})" class="btn btn-sm btn-success"><i class="fas fa-check"></i></button></td></tr>`;
        });
        document.getElementById('ass-body').innerHTML = h || '<tr><td colspan="6" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª</td></tr>';
    });
}
function saveGrade(id) { let g = document.getElementById('g-'+id).value; callApi('gradeAssignment', {rowId:id, grade:g}).then(r => Swal.fire('ØªÙ…', r, 'success')); }

function loadComp() {
    callApi('getComplaintsForAdmin').then(list => {
        let h = '';
        list.forEach(i => { h += `<tr><td>${i.date}</td><td class="fw-bold">${i.name}</td><td>${i.msg}</td><td><div class="input-group"><input class="form-control form-control-sm" id="r-${i.rowId}" placeholder="Ø§Ù„Ø±Ø¯..." value="${i.reply||''}"><button onclick="replyComp(${i.rowId})" class="btn btn-sm btn-primary">Ø¥Ø±Ø³Ø§Ù„</button></div></td></tr>`; });
        document.getElementById('comp-body').innerHTML = h || '<tr><td colspan="4" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰</td></tr>';
    });
}
function replyComp(id) {
    let r = document.getElementById('r-'+id).value;
    if(r) callApi('replyToComplaint', {rowId:id, reply:r}).then(res => Swal.fire('ØªÙ…', res, 'success'));
}

function saveSocialLinks() {
    let links = {
        'Facebook': document.getElementById('social-facebook').value,
        'Instagram': document.getElementById('social-instagram').value,
        'WhatsApp_Link': document.getElementById('social-whatsapp').value,
        'Youtube': document.getElementById('social-youtube').value
    };
    callApi('saveSocialLinks', {links:links}).then(r => {
        if(r.success) Swal.fire('ØªÙ…', r.message, 'success');
    });
}

function saveSettings() {
    let s = { 'TeacherName': document.getElementById('sett-name').value, 'WhatsApp': document.getElementById('sett-wa').value, 'Maintenance': document.getElementById('sett-maint').value };
    callApi('saveGeneralSettings', {s:s}).then(res => Swal.fire('ØªÙ…', res, 'success'));
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© (Reset)
function performReset() {
    let selected = [];
    document.querySelectorAll('.table-chk:checked').forEach(c => selected.push(c.value));
    
    if(selected.length === 0) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'warning');

    Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ØŸ',
        text: "Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„: (" + selected.join(', ') + ") ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¦Ù‡Ø§ ÙØ§Ø±ØºØ©. Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù ÙˆØ§Ø¹Ù…Ù„ ØªÙ‡ÙŠØ¦Ø©',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title: 'Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ØªØ£ÙƒÙŠØ¯',
                input: 'password',
                inputLabel: 'Ù„Ù„Ø£Ù…Ø§Ù†ØŒ Ø§ÙƒØªØ¨: admin',
                inputPlaceholder: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                showCancelButton: true
            }).then((passResult) => {
                if (passResult.value === 'admin') { 
                    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...', allowOutsideClick: false, didOpen: () => Swal.showLoading()});
                    callApi('resetSpecificTables', {tables: selected}).then(r => {
                        Swal.close();
                        if(r.success) {
                            Swal.fire('Ù†Ø¬Ø§Ø­', r.message, 'success').then(() => location.reload());
                        } else {
                            Swal.fire('Ø®Ø·Ø£', r.message, 'error');
                        }
                    });
                } else if (passResult.isConfirmed) {
                    Swal.fire('Ø®Ø·Ø£', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                }
            });
        }
    });
}
</script>
</body>
</html>
