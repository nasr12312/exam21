<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ù†Ø¨Ø±Ø§Ø³ | Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f1f5f9;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- Sidebar Styles --- */
        .sidebar {
            width: 280px;
            height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            background: var(--dark);
            color: white;
            transition: all 0.3s ease;
            z-index: 1000;
            padding-top: 25px;
            box-shadow: -4px 0 15px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 25px 25px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 25px;
            text-align: center;
        }

        .logo-img {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 4px solid var(--warning);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
            object-fit: cover;
        }

        .nav-link {
            color: #cbd5e1;
            padding: 14px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 500;
            transition: all 0.3s;
            border-radius: 10px;
            margin: 0 15px 8px;
            cursor: pointer;
            font-size: 15px;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.05);
            color: white;
            transform: translateX(-5px);
        }

        .nav-link.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }

        .nav-link i {
            width: 25px;
            text-align: center;
            font-size: 18px;
        }

        /* --- Main Content --- */
        .main-content {
            margin-right: 280px;
            padding: 35px;
            transition: all 0.3s ease;
        }

        .header-area {
            background: white;
            padding: 20px 30px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            margin-bottom: 30px;
        }

        /* --- Cards & Stats --- */
        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0,0,0,0.02);
            position: relative;
            overflow: hidden;
            height: 100%;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 6px;
            height: 100%;
        }

        .stat-card.blue::before { background: var(--primary); }
        .stat-card.green::before { background: var(--success); }
        .stat-card.orange::before { background: var(--warning); }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 20px;
        }

        .bg-soft-blue { background: #e0e7ff; color: var(--primary); }
        .bg-soft-green { background: #d1fae5; color: var(--success); }
        .bg-soft-orange { background: #fef3c7; color: var(--warning); }

        /* --- Custom Tables --- */
        .custom-table {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid #f1f5f9;
        }

        .custom-table table {
            margin-bottom: 0;
        }

        .custom-table th {
            background: #f8fafc;
            color: var(--secondary);
            font-weight: 700;
            padding: 20px;
            border-bottom: 2px solid #e2e8f0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .custom-table td {
            padding: 20px;
            vertical-align: middle;
            color: var(--dark);
            border-bottom: 1px solid #f1f5f9;
            font-size: 15px;
        }

        .custom-table tr:last-child td {
            border-bottom: none;
        }

        /* --- Forms & Inputs --- */
        .form-control, .form-select {
            padding: 14px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: none;
            font-size: 15px;
            background-color: #f8fafc;
            transition: all 0.3s;
        }

        .form-control:focus, .form-select:focus {
            background-color: white;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3); }
        
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3); }

        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3); }

        /* --- Badges --- */
        .badge {
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 12px;
        }

        /* --- Code Items --- */
        .code-item {
            background: white;
            border: 1px solid #e2e8f0;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }
        .code-item:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .code-val {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 20px;
            letter-spacing: 2px;
            color: var(--dark);
            margin: 5px 0;
        }

        /* --- Printing Styling (A4 Professional) --- */
        #print-area { display: none; }
        
        @media print {
            body * { visibility: hidden; }
            .sidebar, .header-area, .btn, .no-print { display: none !important; }
            .main-content { margin: 0; padding: 0; width: 100%; background: white; }
            
            #print-area, #print-area * {
                visibility: visible;
            }
            #print-area {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                padding: 20px;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            
            .id-card-print {
                border: 2px solid #000;
                border-radius: 15px;
                padding: 20px;
                display: flex;
                align-items: center;
                gap: 20px;
                page-break-inside: avoid;
                background: white;
                height: 220px; /* Fixed height for A4 consistency */
                position: relative;
            }
            
            .id-photo {
                width: 120px;
                height: 120px;
                object-fit: cover;
                border-radius: 50%;
                border: 3px solid #333;
            }
            
            .id-info {
                flex: 1;
                text-align: right;
            }
            
            .id-info h3 { font-size: 22px; font-weight: 800; margin: 0 0 10px 0; color: black; }
            .id-info p { font-size: 16px; margin: 5px 0; color: #333; font-weight: 600; }
            .id-qr { width: 100px; height: 100px; }
            
            /* Background watermark for ID */
            .id-card-print::before {
                content: 'Ù†Ø¨Ø±Ø§Ø³';
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) rotate(-30deg);
                font-size: 60px;
                color: rgba(0,0,0,0.05);
                font-weight: 900;
                z-index: 0;
            }
        }

        /* --- Mobile Responsive --- */
        @media (max-width: 992px) {
            .sidebar { transform: translateX(100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-right: 0; padding: 20px; }
        }
    </style>
</head>
<body>

<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <img src="https://i.ibb.co/VrJsk41/Gemini-Generated-Image-u0u4kwu0u4kwu0u4.png" class="logo-img">
        <h4 class="mb-0 fw-bold">Ù…Ù†ØµØ© Ù†Ø¨Ø±Ø§Ø³</h4>
        <small class="text-white-50">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ V3.5</small>
    </div>
    
    <div class="nav flex-column">
        <div class="nav-link active" onclick="showTab('home', this)">
            <i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </div>
        <div class="nav-link" onclick="showTab('students', this)">
            <i class="fas fa-users"></i> Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        </div>
        <div class="nav-link" onclick="showTab('results', this)">
            <i class="fas fa-chart-bar"></i> Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        </div>
        <div class="nav-link" onclick="showTab('library', this)">
            <i class="fas fa-book"></i> Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
        </div>
        <div class="nav-link" onclick="showTab('assign', this)">
            <i class="fas fa-tasks"></i> Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª
        </div>
        <div class="nav-link" onclick="showTab('complaints', this)">
            <i class="fas fa-envelope"></i> Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰
        </div>
        <div class="nav-link" onclick="showTab('settings', this)">
            <i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        </div>
    </div>
</div>

<div class="main-content">
    
    <div class="d-flex justify-content-between align-items-center mb-4 header-area no-print">
        <div>
            <h3 class="fw-bold text-dark mb-1">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</h3>
            <p class="text-muted mb-0">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ Ø¥Ù„ÙŠÙƒ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ÙŠÙˆÙ….</p>
        </div>
        <div class="d-flex gap-2">
            <button onclick="location.reload()" class="btn btn-light border">
                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            <button class="btn btn-primary d-lg-none" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>

    <div id="tab-home" class="section-tab">
        <div class="row g-4 mb-4 no-print">
            <div class="col-md-4">
                <div class="stat-card blue">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1 fw-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                            <h2 class="fw-bold mb-0" id="s-cnt">0</h2>
                        </div>
                        <div class="stat-icon bg-soft-blue"><i class="fas fa-user-graduate"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card green">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1 fw-bold">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</p>
                            <h2 class="fw-bold mb-0" id="e-cnt">0</h2>
                        </div>
                        <div class="stat-icon bg-soft-green"><i class="fas fa-file-alt"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card orange">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted mb-1 fw-bold">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ØªÙˆÙØ±Ø©</p>
                            <h2 class="fw-bold mb-0" id="c-cnt">0</h2>
                        </div>
                        <div class="stat-icon bg-soft-orange"><i class="fas fa-barcode"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row no-print">
            <div class="col-lg-8 mb-4">
                <div class="card border-0 shadow-sm p-4 h-100">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="fw-bold m-0"><i class="fas fa-plus-circle text-primary"></i> ØªÙˆÙ„ÙŠØ¯ Ø£ÙƒÙˆØ§Ø¯ ØªÙØ¹ÙŠÙ„</h5>
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label text-muted small">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</label>
                            <input id="gen-count" type="number" class="form-control" placeholder="Ù…Ø«Ù„Ø§Ù‹: 50">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                            <input id="gen-cls" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØªØ§Ø³Ø¹ Ø£">
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label text-muted small">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                            <select id="gen-type" class="form-select">
                                <option value="Full">Ø§Ø´ØªØ±Ø§Ùƒ ÙƒØ§Ù…Ù„ (Ù…Ø¯ÙÙˆØ¹)</option>
                                <option value="Trial">ØªØ¬Ø±ÙŠØ¨ÙŠ (Ù…Ø¬Ø§Ù†ÙŠ)</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label text-muted small">Ø§Ù„Ù…Ø¯Ø© (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
                            <input id="gen-dur" type="number" class="form-control" placeholder="Ù…Ø«Ù„Ø§Ù‹: 120" value="120">
                        </div>
                        
                        <div class="col-12 mt-4">
                            <button onclick="generate()" class="btn btn-primary w-100 py-3">
                                <i class="fas fa-cogs"></i> ØªÙˆÙ„ÙŠØ¯ ÙˆØ­ÙØ¸ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
                            </button>
                        </div>
                    </div>

                    <hr class="my-4">
                    
                    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                        <h6 class="fw-bold m-0 text-dark">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</h6>
                        <div class="d-flex gap-2">
                            <select id="f-cls" class="form-select form-select-sm" style="width:130px" onchange="render()"><option value="all">ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option></select>
                            <select id="f-sts" class="form-select form-select-sm" style="width:130px" onchange="render()"><option value="New">Ø¬Ø¯ÙŠØ¯Ø©</option><option value="Used">Ù…Ø³ØªØ®Ø¯Ù…Ø©</option><option value="all">Ø§Ù„ÙƒÙ„</option></select>
                            <button onclick="deleteUsedCodes()" class="btn btn-sm btn-outline-danger">ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
                            <button onclick="printCodes()" class="btn btn-sm btn-dark"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©</button>
                        </div>
                    </div>
                    
                    <div id="code-container" style="max-height:400px; overflow-y:auto; display:grid; grid-template-columns:repeat(auto-fill, minmax(160px, 1fr)); gap:15px; padding: 5px;">
                        <div class="text-center w-100 text-muted py-5">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 mb-4">
                <div class="card border-0 shadow-sm p-4 h-100 bg-dark text-white" style="background: linear-gradient(135deg, #1e293b, #0f172a);">
                    <h5 class="fw-bold mb-3"><i class="fas fa-paper-plane text-warning"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±</h5>
                    <p class="text-white-50 small mb-4">Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ ÙÙˆØ±ÙŠ Ù„Ù„Ø·Ù„Ø§Ø¨ ÙŠØ¸Ù‡Ø± ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</p>
                    
                    <div class="mb-3">
                        <label class="mb-2 small">Ø§Ù„Ù…Ø³ØªÙ„Ù…ÙˆÙ†:</label>
                        <select id="msg-target" class="form-select bg-white text-dark border-0">
                            <option value="All">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="mb-2 small">Ø£Ùˆ Ø¨Ø±ÙŠØ¯ Ù…Ø­Ø¯Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <input id="msg-email-manual" class="form-control bg-white text-dark border-0" placeholder="example@gmail.com">
                    </div>
                    
                    <div class="mb-4">
                        <label class="mb-2 small">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                        <textarea id="msg-text" class="form-control" rows="4" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                    </div>
                    
                    <button onclick="sendMsg()" class="btn btn-warning w-100 fw-bold py-2">
                        <i class="fas fa-share"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-students" class="section-tab d-none">
        <div class="d-flex justify-content-between align-items-center mb-4 no-print">
            <h4 class="fw-bold text-dark">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h4>
            <button onclick="printCards()" class="btn btn-success">
                <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (A4)
            </button>
        </div>
        
        <div class="card p-4 mb-4 border-0 shadow-sm no-print">
            <h6 class="fw-bold mb-3 text-secondary">Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h6>
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="small text-muted">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ø·Ø§Ù„Ø¨</label>
                    <input id="m-email" class="form-control" placeholder="example@gmail.com">
                </div>
                <div class="col-md-4">
                    <label class="small text-muted">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input id="m-pass" class="form-control" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø­Ø°Ù">
                </div>
                <div class="col-md-2">
                    <button onclick="resetPass()" class="btn btn-warning w-100">ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯</button>
                </div>
                <div class="col-md-2">
                    <button onclick="delStudent()" class="btn btn-danger w-100">Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button>
                </div>
            </div>
        </div>

        <div id="ids-grid" class="row g-4 no-print">
            </div>
    </div>

    <div id="tab-results" class="section-tab d-none">
        <div class="d-flex justify-content-between align-items-center mb-4 no-print">
            <h4 class="fw-bold text-dark">Ø³Ø¬Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</h4>
            <div class="d-flex gap-2 bg-white p-2 rounded shadow-sm">
                <input type="text" id="res-search" class="form-control border-0" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨..." onkeyup="filterResults()">
                <select id="res-cls-filter" class="form-select border-0 bg-light" style="width:150px" onchange="filterResults()">
                    <option value="all">ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option>
                </select>
                <button onclick="exportToExcel()" class="btn btn-success text-nowrap">
                    <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Ø§ÙƒØ³Ù„
                </button>
            </div>
        </div>
        
        <div class="custom-table">
            <table class="table table-hover mb-0 w-100" id="res-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                        <th>Ø§Ù„ØµÙ</th>
                        <th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th>
                        <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="res-body">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="tab-library" class="section-tab d-none">
        <div class="row g-4">
            <div class="col-lg-4">
                <div class="card p-4 border-0 shadow-sm">
                    <h5 class="fw-bold mb-4 text-primary">Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h5>
                    <div class="mb-3">
                        <label class="form-label small text-muted">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³</label>
                        <input id="lib-title" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø±Ø­ Ù‚Ø§Ø¹Ø¯Ø©...">
                    </div>
                    <div class="mb-3">
                        <label class="form-label small text-muted">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
                        <select id="lib-type" class="form-select">
                            <option value="PDF">Ù…Ù„Ù PDF</option>
                            <option value="Video">ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small text-muted">Ø§Ù„ØµÙ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label>
                        <input id="lib-cls" class="form-control" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹">
                    </div>
                    <div class="mb-4">
                        <label class="form-label small text-muted">Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</label>
                        <input id="lib-link" class="form-control" placeholder="https://...">
                    </div>
                    <button onclick="addLib()" class="btn btn-primary w-100">Ù†Ø´Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="custom-table">
                    <table class="table table-hover mb-0 w-100">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„ØµÙ</th>
                                <th>Ø­Ø°Ù</th>
                            </tr>
                        </thead>
                        <tbody id="lib-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-assign" class="section-tab d-none">
        <h4 class="fw-bold mb-4">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù…Ù† Ø§Ù„Ø·Ù„Ø§Ø¨</h4>
        <div class="custom-table">
            <table class="table table-hover mb-0 w-100">
                <thead>
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                        <th>Ù†ÙˆØ¹ Ø§Ù„ÙˆØ§Ø¬Ø¨</th>
                        <th>Ø§Ù„ÙˆØµÙ / Ø§Ù„Ø±Ø§Ø¨Ø·</th>
                        <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                        <th>Ø±ØµØ¯</th>
                    </tr>
                </thead>
                <tbody id="ass-body">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="tab-complaints" class="section-tab d-none">
        <h4 class="fw-bold mb-4">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h4>
        <div class="custom-table">
            <table class="table table-hover mb-0 w-100">
                <thead>
                    <tr>
                        <th width="15%">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th width="20%">Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                        <th width="35%">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                        <th width="30%">Ø§Ù„Ø±Ø¯ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</th>
                    </tr>
                </thead>
                <tbody id="comp-body">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="tab-settings" class="section-tab d-none">
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card p-4 border-0 shadow-sm h-100">
                    <h5 class="fw-bold mb-4"><i class="fas fa-user-cog text-primary"></i> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h5>
                    
                    <label class="form-label small text-muted">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©)</label>
                    <input id="sett-name" class="form-control mb-3" placeholder="Ø£. ÙÙ„Ø§Ù† Ø§Ù„ÙÙ„Ø§Ù†ÙŠ">
                    
                    <label class="form-label small text-muted">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø´Ø®ØµÙŠ (Ù„Ù„ØªØ¬Ø¯ÙŠØ¯)</label>
                    <input id="sett-wa" class="form-control mb-3" placeholder="https://wa.me/96200000000">
                    
                    <label class="form-label small text-muted">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØµØ©</label>
                    <select id="sett-maint" class="form-select mb-4">
                        <option value="Off">ğŸŸ¢ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ</option>
                        <option value="On">ğŸ”´ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø© (Ù…ØºÙ„Ù‚Ø©)</option>
                    </select>
                    
                    <button onclick="saveSettings()" class="btn btn-primary w-100">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card p-4 border-0 shadow-sm h-100">
                    <h5 class="fw-bold mb-4"><i class="fas fa-share-alt text-primary"></i> Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</h5>
                    
                    <div class="mb-3">
                        <label class="small text-muted"><i class="fab fa-whatsapp text-success"></i> Ø±Ø§Ø¨Ø· Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
                        <input id="social-whatsapp" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="small text-muted"><i class="fab fa-facebook text-primary"></i> ØµÙØ­Ø© Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ</label>
                        <input id="social-facebook" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="small text-muted"><i class="fab fa-instagram text-danger"></i> Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…</label>
                        <input id="social-instagram" class="form-control">
                    </div>
                    <div class="mb-4">
                        <label class="small text-muted"><i class="fab fa-youtube text-danger"></i> Ù‚Ù†Ø§Ø© Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨</label>
                        <input id="social-youtube" class="form-control">
                    </div>
                    
                    <button onclick="saveSocialLinks()" class="btn btn-success w-100">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
                </div>
            </div>
        </div>
        
        <div class="row g-4 mt-2">
            <div class="col-12">
                <div class="card p-4 border-0 shadow-sm border-start border-danger border-5">
                    <h5 class="fw-bold text-danger mb-3"><i class="fas fa-exclamation-triangle"></i> Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© (Ø­Ø°Ù ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡)</h5>
                    <p class="text-muted">ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø³ÙŠØ¤Ø¯ÙŠ Ù„Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© ÙˆØ¥Ø¹Ø§Ø¯ØªÙ‡Ø§ Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…ØµÙ†Ø¹.</p>
                    
                    <div class="row" id="tables-checklist">
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Students"><label class="form-check-label">Ø§Ù„Ø·Ù„Ø§Ø¨ (Students)</label></div></div>
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Exams"><label class="form-check-label">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª (Exams)</label></div></div>
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Questions"><label class="form-check-label">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Questions)</label></div></div>
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Results"><label class="form-check-label">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Results)</label></div></div>
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Codes"><label class="form-check-label">Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Codes)</label></div></div>
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Assignments"><label class="form-check-label">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª (Assignments)</label></div></div>
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Library"><label class="form-check-label">Ø§Ù„Ù…ÙƒØªØ¨Ø© (Library)</label></div></div>
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Complaints"><label class="form-check-label">Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ (Complaints)</label></div></div>
                        <div class="col-md-3"><div class="form-check"><input class="form-check-input table-chk" type="checkbox" value="Notifications"><label class="form-check-label">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Notifications)</label></div></div>
                    </div>
                    
                    <div class="mt-4">
                        <button onclick="performReset()" class="btn btn-danger fw-bold py-2 px-4">
                            <i class="fas fa-trash-alt"></i> ØªÙ†ÙÙŠØ° Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù„Ù„Ù…Ø­Ø¯Ø¯
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<div id="print-area"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ===========================================
// âš ï¸ Ù‡Ø§Ù…: ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø³ÙŠØ±ÙØ±
// Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† New Deployment ÙˆØ¶Ø¹Ù‡ Ù‡Ù†Ø§
const API_URL = "https://script.google.com/macros/s/AKfycbyfF_pkwka9-aTWrJme-tzqnEstDabGYg1XrQF7TGvhoo8f48asvUjeSC1AOWFflcv5/exec"; 
// ===========================================

let allData=[], allResults=[], allStudents=[];

// Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
window.onload = function() { loadAllData(); };

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø¹Ø§Ù…Ø©
async function callApi(action, data = {}) {
    data.action = action;
    try {
        const response = await fetch(API_URL, { method: 'POST', body: JSON.stringify(data) });
        return await response.json();
    } catch (e) { 
        console.error(e);
        // ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„Ø§ Ù†Ø²Ø¹Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù„ÙƒÙ† ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ù†Ø¸Ù‡Ø± Ø®Ø·Ø£
        return {success: false, message: "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„"}; 
    }
}

// ØªØ­Ù…ÙŠÙ„ ÙƒØ§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
function loadAllData() {
    Swal.fire({
        title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…...', 
        allowOutsideClick: false, 
        didOpen: () => Swal.showLoading()
    });
    
    callApi('getAdminData').then(data => {
        Swal.close();
        if(data && data.stats) {
            init(data);
        } else {
            Swal.fire({
                icon: 'warning',
                title: 'ØªÙ†Ø¨ÙŠÙ‡',
                text: 'Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ø´Ø± (Deployment URL).',
                footer: '<a href="#">ÙƒÙŠÙ Ø£Ù‚ÙˆÙ… Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«ØŸ</a>'
            });
        }
    });
}

// ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ±
function init(data) {
  try {
      allData = data.codes || [];
      document.getElementById('s-cnt').innerText = data.stats.students || 0;
      document.getElementById('e-cnt').innerText = data.stats.exams || 0;
      document.getElementById('c-cnt').innerText = data.stats.codes || 0;

      // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†ØµØ©
      if(data.settings) {
          if(document.getElementById('sett-name')) document.getElementById('sett-name').value = data.settings['TeacherName'] || '';
          if(document.getElementById('sett-wa')) document.getElementById('sett-wa').value = data.settings['WhatsApp'] || '';
          if(document.getElementById('sett-maint')) document.getElementById('sett-maint').value = data.settings['Maintenance'] || 'Off';
      }
      
      // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„
      if(data.socials) {
          if(document.getElementById('social-facebook')) document.getElementById('social-facebook').value = data.socials.facebook || '';
          if(document.getElementById('social-instagram')) document.getElementById('social-instagram').value = data.socials.instagram || '';
          if(document.getElementById('social-whatsapp')) document.getElementById('social-whatsapp').value = data.socials.whatsapp || '';
          if(document.getElementById('social-youtube')) document.getElementById('social-youtube').value = data.socials.youtube || '';
      }

      // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© (Ø§Ù„ØµÙÙˆÙ)
      let classes = [...new Set(allData.map(i=>i.cls).filter(c => c && c.trim() !== ""))];
      
      ['f-cls', 'res-cls-filter'].forEach(id => {
          let sel = document.getElementById(id);
          if(sel) {
              sel.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option>';
              classes.forEach(c => { 
                  let o = document.createElement('option'); o.value = c; o.innerText = c; sel.appendChild(o); 
              });
          }
      });

      let msgSel = document.getElementById('msg-target');
      if(msgSel) {
          msgSel.innerHTML = '<option value="All">Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</option>';
          classes.forEach(c => { 
              let o = document.createElement('option'); o.value = c; o.innerText = "Ø·Ù„Ø§Ø¨ " + c; msgSel.appendChild(o); 
          });
      }

      render(); // Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
  } catch(e) {
      console.error("Init Error: ", e);
  }
}

// Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
function showTab(tabId, el) {
    document.querySelectorAll('.section-tab').forEach(d => d.classList.add('d-none'));
    document.getElementById('tab-'+tabId).classList.remove('d-none');
    document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
    el.classList.add('active');
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø¹Ù†Ø¯ ÙØªØ­Ù‡
    if(tabId === 'students') loadIds();
    if(tabId === 'results') loadResults();
    if(tabId === 'library') loadLibrary();
    if(tabId === 'assign') loadAssign();
    if(tabId === 'complaints') loadComp();
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
    if(window.innerWidth < 992) document.getElementById('sidebar').classList.remove('active');
}

function toggleSidebar() { 
    document.getElementById('sidebar').classList.toggle('active'); 
}

// --- Ù‚Ø³Ù… Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ---
function render() {
  let clsElem = document.getElementById('f-cls');
  let stsElem = document.getElementById('f-sts');
  
  let cls = clsElem ? clsElem.value : 'all';
  let sts = stsElem ? stsElem.value : 'New'; 

  if(!allData) return;

  let filtered = allData.filter(c => (cls=='all'||c.cls==cls) && (sts=='all'||c.status==sts));
  let h = '';
  filtered.forEach(c => {
    // Ø¨Ø§Ø¯Ø¬ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
    let typeBadge = c.type === 'Trial' 
        ? '<span class="badge bg-warning text-dark" style="font-size:10px">ØªØ¬Ø±ÙŠØ¨ÙŠ</span>' 
        : '<span class="badge bg-primary" style="font-size:10px">ÙƒØ§Ù…Ù„</span>';
        
    h += `<div class="code-item">
            <div class="fw-bold small text-muted">${c.cls}</div>
            <div class="code-val">${c.code}</div>
            <div class="d-flex justify-content-center gap-1 mt-2">
                <span class="badge ${c.status=='New'?'bg-success':'bg-secondary'}">${c.status=='New'?'Ø¬Ø¯ÙŠØ¯':'Ù…Ø³ØªØ®Ø¯Ù…'}</span>
                ${typeBadge}
            </div>
          </div>`;
  });
  document.getElementById('code-container').innerHTML = h || '<div class="text-center w-100 text-muted p-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª (Ø¬Ø±Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ„ØªØ±)</div>';
}

function generate() {
  let count = document.getElementById('gen-count').value;
  let cls = document.getElementById('gen-cls').value;
  let type = document.getElementById('gen-type').value;
  let dur = document.getElementById('gen-dur').value;

  if(!count || !cls || !dur) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
  
  Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...', didOpen: () => Swal.showLoading()});
  callApi('generateNewCodes', {count:count, cls:cls, type:type, duration:dur})
    .then(res => { 
        Swal.fire('ØªÙ…', res, 'success').then(() => location.reload()); 
    });
}

function deleteUsedCodes(){
   Swal.fire({title:'ØªØ£ÙƒÙŠØ¯ØŸ', text:'Ø­Ø°Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©ØŸ', icon:'warning', showCancelButton:true}).then(r=>{
       if(r.isConfirmed) {
           Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...', didOpen: () => Swal.showLoading()});
           callApi('deleteUsedCodes').then(res => Swal.fire('ØªÙ…', res, 'success'));
       }
   });
}

// --- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ---
function sendMsg() {
  let manualEmail = document.getElementById('msg-email-manual').value;
  let target = manualEmail ? manualEmail.trim() : document.getElementById('msg-target').value;
  let m = document.getElementById('msg-text').value;
  
  if(!m) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'warning');
  
  Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...', didOpen: () => Swal.showLoading()});
  callApi('sendTargetedMessage', {target:target, msg:m}).then(res => {
      Swal.fire('ØªÙ…', 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      document.getElementById('msg-text').value = '';
  });
}

// --- Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ---
function loadIds() {
    document.getElementById('ids-grid').innerHTML = '<div class="text-center w-100 py-5"><i class="fas fa-spinner fa-spin fa-2x text-primary"></i></div>';
    callApi('getStudentsForCards').then(list => {
        allStudents = list || [];
        let h = '';
        if(!list || list.length === 0) h = '<div class="alert alert-info w-100 text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯</div>';
        else list.forEach(s => {
            let qr = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=' + encodeURIComponent(s.email);
            let userImg = s.photo && s.photo.length > 20 ? s.photo : 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
            h += `<div class="col-md-4 col-lg-3">
                    <div class="card p-3 shadow-sm text-center h-100 position-relative border-0">
                        <img src="${userImg}" style="width:80px;height:80px;border-radius:50%;margin:0 auto;object-fit:cover;border:3px solid var(--primary);box-shadow:0 4px 10px rgba(0,0,0,0.1)">
                        <h6 class="mt-3 fw-bold mb-1 text-dark">${s.name}</h6>
                        <span class="badge bg-soft-blue text-primary mb-2">${s.cls}</span>
                        <div class="mt-auto mb-2"><img src="${qr}" style="width:80px"></div>
                        <div class="small text-muted mt-1 text-break" style="font-size:11px">${s.email}</div>
                    </div>
                  </div>`;
        });
        document.getElementById('ids-grid').innerHTML = h;
    });
}

function printCards() {
    if(!allStudents.length) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©', 'info');
    let h = '';
    allStudents.forEach(s => {
        let qr = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=' + encodeURIComponent(s.email);
        let userImg = s.photo && s.photo.length > 20 ? s.photo : 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
        h += `<div class="id-card-print">
                 <img src="${userImg}" class="id-photo">
                 <div class="id-info">
                    <h3 style="margin:0; font-weight:bold; color:#000;">${s.name}</h3>
                    <p style="margin:5px 0; font-size:18px;">Ø§Ù„ØµÙ: ${s.cls}</p>
                    <p style="margin:0; font-size:12px; color:#555;">${s.email}</p>
                 </div>
                 <img src="${qr}" class="id-qr">
              </div>`;
    });
    document.getElementById('print-area').innerHTML = h;
    window.print();
}

function printCodes() {
   let content = document.getElementById('code-container').innerHTML;
   let win = window.open('', '', 'height=700,width=900');
   win.document.write('<html><head><title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</title>');
   win.document.write('<style>body{font-family:sans-serif; direction:rtl} .grid{display:grid; grid-template-columns:repeat(4, 1fr); gap:15px; padding:20px} .code-item{border:1px solid #000; padding:15px; text-align:center; border-radius:10px} .code-val{font-size:24px; font-weight:bold; margin:10px 0}</style>');
   win.document.write('</head><body>');
   win.document.write('<div class="grid">' + content + '</div>');
   win.document.write('</body></html>');
   win.document.close();
   win.print();
}

// --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ---
function resetPass(){ 
    let e = document.getElementById('m-email').value;
    let p = document.getElementById('m-pass').value; 
    if(!e || !p) return Swal.fire('Ù†Ù‚Øµ', 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©', 'warning'); 
    
    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØºÙŠÙŠØ±...', didOpen: () => Swal.showLoading()});
    callApi('adminResetPass', {email:e, newPass:p}).then(res => Swal.fire('ØªÙ…', res, 'success')); 
}

function delStudent(){ 
    let e = document.getElementById('m-email').value; 
    if(!e) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'warning'); 
    
    Swal.fire({title:'Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ', text:"Ù„Ù† ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø§Ø¨!", icon:'warning', showCancelButton:true}).then(r=>{ 
        if(r.isConfirmed) {
            Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...', didOpen: () => Swal.showLoading()});
            callApi('deleteStudent', {email:e}).then(res => Swal.fire('ØªÙ…', res, 'success')); 
        }
    }); 
}

// --- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ---
function loadResults() { 
    document.getElementById('res-body').innerHTML = '<tr><td colspan="6" class="text-center py-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
    callApi('getAllResultsForAdmin').then(data => { allResults = data || []; renderResults(data || []); }); 
}

function renderResults(data) {
    let tbody = document.getElementById('res-body');
    if(!data.length) { tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>'; return; }
    let h = '';
    data.forEach(r => {
        h += `<tr>
                <td>${r.date}</td>
                <td class="fw-bold">${r.name}</td>
                <td>${r.cls}</td>
                <td>${r.exam}</td>
                <td><span class="badge ${parseInt(r.score)>=50?'bg-success':'bg-danger'}">${r.score}</span></td>
                <td><button class="btn btn-sm btn-outline-danger" onclick="deleteRes(${r.rowId})"><i class="fas fa-trash"></i></button></td>
              </tr>`;
    });
    tbody.innerHTML = h;
}

function filterResults() {
    let q = document.getElementById('res-search').value.toLowerCase();
    let cls = document.getElementById('res-cls-filter').value;
    let filtered = allResults.filter(r => (r.name.toLowerCase().includes(q) || r.exam.toLowerCase().includes(q)) && (cls === 'all' || r.cls === cls));
    renderResults(filtered);
}

function deleteRes(rowId) { 
    Swal.fire({title:'Ø­Ø°Ù Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŸ', icon:'warning', showCancelButton:true}).then(r=>{ 
        if(r.isConfirmed) callApi('deleteResultRow', {rowId:rowId}).then(msg => { loadResults(); }); 
    }); 
}

function exportToExcel() {
    let csv = "\uFEFFØ§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„Ø·Ø§Ù„Ø¨,Ø§Ù„ØµÙ,Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†,Ø§Ù„Ø¯Ø±Ø¬Ø©\n";
    allResults.forEach(r => { csv += `${r.date},${r.name},${r.cls},${r.exam},${r.score}\n`; });
    let link = document.createElement("a"); link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv); link.download = "Ø§Ù„Ù†ØªØ§Ø¦Ø¬.csv"; link.click();
}

// --- Ø§Ù„Ù…ÙƒØªØ¨Ø© ---
function loadLibrary() {
    document.getElementById('lib-body').innerHTML = '<tr><td colspan="4" class="text-center">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
    callApi('getLibraryForAdmin').then(list => {
        let h = '';
        (list || []).forEach(i => {
            let icon = i.type == 'Video' ? '<i class="fas fa-video text-danger"></i>' : '<i class="fas fa-file-pdf text-warning"></i>';
            h += `<tr>
                    <td>${icon} ${i.title}</td>
                    <td>${i.type}</td>
                    <td>${i.cls||'Ø§Ù„ÙƒÙ„'}</td>
                    <td><button class="btn btn-sm btn-danger" onclick="delLib(${i.rowId})"><i class="fas fa-trash"></i></button></td>
                  </tr>`;
        });
        document.getElementById('lib-body').innerHTML = h || '<tr><td colspan="4" class="text-center text-muted">Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙØ§Ø±ØºØ©</td></tr>';
    });
}

function addLib() {
    let d = { 
        title: document.getElementById('lib-title').value, 
        type: document.getElementById('lib-type').value, 
        cls: document.getElementById('lib-cls').value, 
        link: document.getElementById('lib-link').value 
    };
    if(!d.title || !d.link) return Swal.fire('Ù†Ù‚Øµ', 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
    
    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...', didOpen: () => Swal.showLoading()});
    callApi('addToLibrary', {d:d}).then(r=>{ Swal.fire('ØªÙ…', r, 'success'); loadLibrary(); });
}

function delLib(id) { 
    if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) callApi('deleteLibraryItem', {rowId:id}).then(r=>{ loadLibrary(); }); 
}

// --- Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª ---
function loadAssign() {
    document.getElementById('ass-body').innerHTML = '<tr><td colspan="6" class="text-center">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
    callApi('getAssignmentsForAdmin').then(list => {
        let h = '';
        (list || []).forEach(i => {
            h += `<tr>
                    <td>${i.date}</td>
                    <td>${i.name}</td>
                    <td>${i.type}</td>
                    <td><a href="${i.link}" target="_blank" class="btn btn-sm btn-primary">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</a></td>
                    <td><input id="g-${i.rowId}" value="${i.grade}" style="width:60px" class="form-control form-control-sm text-center"></td>
                    <td><button onclick="saveGrade(${i.rowId})" class="btn btn-sm btn-success"><i class="fas fa-check"></i></button></td>
                  </tr>`;
        });
        document.getElementById('ass-body').innerHTML = h || '<tr><td colspan="6" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ§Ø¬Ø¨Ø§Øª</td></tr>';
    });
}

function saveGrade(id) { 
    let g = document.getElementById('g-'+id).value; 
    callApi('gradeAssignment', {rowId:id, grade:g}).then(r => Swal.fire('ØªÙ…', r, 'success')); 
}

// --- Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ---
function loadComp() {
    document.getElementById('comp-body').innerHTML = '<tr><td colspan="4" class="text-center">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
    callApi('getComplaintsForAdmin').then(list => {
        let h = '';
        (list || []).forEach(i => { 
            h += `<tr>
                    <td>${i.date}</td>
                    <td class="fw-bold">${i.name}</td>
                    <td class="text-muted small">${i.msg}</td>
                    <td>
                        <div class="input-group">
                            <input class="form-control form-control-sm" id="r-${i.rowId}" placeholder="Ø§Ù„Ø±Ø¯..." value="${i.reply||''}">
                            <button onclick="replyComp(${i.rowId})" class="btn btn-sm btn-primary">Ø¥Ø±Ø³Ø§Ù„</button>
                        </div>
                    </td>
                  </tr>`; 
        });
        document.getElementById('comp-body').innerHTML = h || '<tr><td colspan="4" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´ÙƒØ§ÙˆÙ‰</td></tr>';
    });
}

function replyComp(id) { 
    let r = document.getElementById('r-'+id).value; 
    if(r) callApi('replyToComplaint', {rowId:id, reply:r}).then(res => Swal.fire('ØªÙ…', res, 'success')); 
}

// --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ---
function saveSocialLinks() {
    let links = {
        'Facebook': document.getElementById('social-facebook').value,
        'Instagram': document.getElementById('social-instagram').value,
        'WhatsApp_Link': document.getElementById('social-whatsapp').value,
        'Youtube': document.getElementById('social-youtube').value
    };
    callApi('saveSocialLinks', {links:links}).then(r => { if(r.success) Swal.fire('ØªÙ…', r.message, 'success'); });
}

function saveSettings() {
    let s = { 
        'TeacherName': document.getElementById('sett-name').value, 
        'WhatsApp': document.getElementById('sett-wa').value, 
        'Maintenance': document.getElementById('sett-maint').value 
    };
    callApi('saveGeneralSettings', {s:s}).then(res => Swal.fire('ØªÙ…', res, 'success'));
}

// --- Ø§Ù„ØªÙ‡ÙŠØ¦Ø© (Danger Zone) ---
function performReset() {
    let selected = [];
    document.querySelectorAll('.table-chk:checked').forEach(c => selected.push(c.value));
    
    if(selected.length === 0) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'warning');

    Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ØŸ',
        text: "Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„: (" + selected.join(', ') + ") ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¦Ù‡Ø§ ÙØ§Ø±ØºØ©. Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù ÙˆØ§Ø¹Ù…Ù„ ØªÙ‡ÙŠØ¦Ø©',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡'
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title: 'Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„ØªØ£ÙƒÙŠØ¯',
                input: 'password',
                inputLabel: 'Ù„Ù„Ø£Ù…Ø§Ù†ØŒ Ø§ÙƒØªØ¨: admin',
                inputPlaceholder: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                showCancelButton: true
            }).then((passResult) => {
                if (passResult.value === 'admin') { 
                    Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...', allowOutsideClick: false, didOpen: () => Swal.showLoading()});
                    callApi('resetSpecificTables', {tables: selected}).then(r => {
                        Swal.close();
                        if(r.success) {
                            Swal.fire('Ù†Ø¬Ø§Ø­', r.message, 'success').then(() => location.reload());
                        } else {
                            Swal.fire('Ø®Ø·Ø£', r.message, 'error');
                        }
                    });
                } else if (passResult.isConfirmed) {
                    Swal.fire('Ø®Ø·Ø£', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                }
            });
        }
    });
}
</script>
</body>
</html>
