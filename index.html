<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Ù…Ù†ØµØ© Ù†Ø¨Ø±Ø§Ø³ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© - Ø§Ù„Ø­Ù„ Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø°ÙƒÙŠ">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Ù…Ù†ØµØ© Ù†Ø¨Ø±Ø§Ø³ | Enterprise Edition</title>

    <!-- =======================================================
         1. Ø§Ù„Ø£ØµÙˆÙ„ ÙˆØ§Ù„Ù…ÙƒØªØ¨Ø§Øª (Assets & Libraries)
         ======================================================= -->
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <!-- Animation Library (AOS) -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Utilities -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>

    <style>
        /* =======================================================
           2. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ (Enterprise Design System)
           ======================================================= */
        :root {
            /* --- Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Modern Slate Theme) --- */
            --bg-body: #0f172a;
            --bg-surface: #1e293b;
            --bg-surface-2: #334155;
            --bg-surface-hover: #475569;
            
            --bg-glass: rgba(15, 23, 42, 0.85);
            --bg-glass-strong: rgba(15, 23, 42, 0.98);
            
            /* --- Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‡ÙˆÙŠØ© --- */
            --primary: #6366f1; /* Indigo */
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --primary-alpha: rgba(99, 102, 241, 0.15);
            
            --secondary: #0ea5e9; /* Sky */
            --accent: #f59e0b; /* Amber */
            --success: #10b981;
            --danger: #ef4444;
            --purple: #8b5cf6;
            
            /* --- Ø§Ù„Ù†ØµÙˆØµ --- */
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --text-dim: #64748b;
            --font-ui: 'Cairo', sans-serif;
            --font-body: 'Tajawal', sans-serif;

            /* --- Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ --- */
            --border: 1px solid rgba(255, 255, 255, 0.08);
            --border-hover: 1px solid rgba(99, 102, 241, 0.5);
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-neon: 0 0 15px rgba(99, 102, 241, 0.3);

            /* --- Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ --- */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --header-h: 70px;
            --nav-h: 80px;
        }

        [data-theme="light"] {
            --bg-body: #f8fafc;
            --bg-surface: #ffffff;
            --bg-surface-2: #f1f5f9;
            --bg-surface-hover: #e2e8f0;
            --bg-glass: rgba(255, 255, 255, 0.9);
            --bg-glass-strong: rgba(255, 255, 255, 0.98);
            --text-main: #0f172a;
            --text-muted: #475569;
            --text-dim: #94a3b8;
            --border: 1px solid rgba(0,0,0,0.06);
            --shadow-neon: 0 0 15px rgba(99, 102, 241, 0.15);
        }

        /* =======================================================
           3. Ø§Ù„ØªØ£Ø³ÙŠØ³ (Base & Reset)
           ======================================================= */
        *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; margin: 0; padding: 0; }
        
        html { scroll-behavior: smooth; font-size: 16px; }
        
        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-body);
            min-height: 100vh;
            overflow-x: hidden;
            /* Ø®Ù„ÙÙŠØ© Ø´Ø¨ÙƒÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--bg-surface-2); border-radius: 10px; }
        
        /* Typography */
        h1, h2, h3, h4, h5, h6 { font-family: var(--font-ui); font-weight: 700; line-height: 1.3; }
        a { text-decoration: none; color: inherit; transition: 0.2s; }
        button { cursor: pointer; border: none; background: none; font-family: inherit; }

        /* Utility Classes */
        .container { max-width: 600px; margin: 0 auto; padding: 20px; width: 100%; position: relative; z-index: 1; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .text-center { text-align: center; }
        .hidden { display: none !important; }
        .font-ui { font-family: var(--font-ui); }
        .text-gradient { background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .text-accent-gradient { background: linear-gradient(135deg, var(--accent), #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .w-full { width: 100%; }
        .mt-4 { margin-top: 1rem; }
        .mb-4 { margin-bottom: 1rem; }
        .py-5 { padding-top: 3rem; padding-bottom: 3rem; }

        /* =======================================================
           4. Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª (Components)
           ======================================================= */
        
        /* 4.1 Buttons */
        .btn {
            position: relative; overflow: hidden;
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            padding: 14px 24px; font-size: 1rem; font-weight: 700;
            border-radius: var(--radius-md); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: var(--font-ui); box-shadow: var(--shadow-sm);
        }
        .btn:active { transform: scale(0.97); }
        
        .btn-primary { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
            color: white; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        .btn-primary:hover { box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6); transform: translateY(-2px); }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #d97706);
            color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        
        .btn-glass {
            background: rgba(255,255,255,0.05); color: var(--text-main);
            border: 1px solid var(--border); backdrop-filter: blur(5px);
        }
        .btn-glass:hover { background: rgba(255,255,255,0.1); border-color: var(--text-muted); }
        
        .btn-icon { width: 45px; height: 45px; border-radius: 50%; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: 0.3s; }
        .btn-icon:hover { background: var(--bg-surface-2); color: var(--primary); }

        /* 4.2 Cards */
        .card {
            background: var(--bg-surface); border: var(--border); border-radius: var(--radius-lg);
            padding: 20px; margin-bottom: 20px; transition: 0.3s; position: relative; overflow: hidden;
        }
        .card:hover { transform: translateY(-3px); box-shadow: var(--shadow-neon); border-color: var(--primary); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-size: 1.1rem; font-weight: 700; font-family: var(--font-ui); margin: 0; }

        /* 4.3 Inputs */
        .input-wrap { position: relative; margin-bottom: 20px; }
        .input-icon { position: absolute; top: 50%; right: 16px; transform: translateY(-50%); color: var(--text-muted); transition: 0.3s; z-index: 2; }
        .form-input {
            width: 100%; padding: 16px 50px 16px 20px; background: var(--bg-surface-2);
            border: 1px solid transparent; border-radius: var(--radius-md);
            color: var(--text-main); font-size: 1rem; transition: 0.3s; font-family: inherit;
        }
        .form-input:focus { background: var(--bg-surface); border-color: var(--primary); box-shadow: 0 0 0 4px var(--primary-alpha); }
        .input-wrap:focus-within .input-icon { color: var(--primary); }

        /* 4.4 List Items */
        .list-item {
            display: flex; align-items: center; gap: 15px; padding: 15px;
            background: var(--bg-surface); border: var(--border); border-radius: var(--radius-md);
            cursor: pointer; transition: 0.2s; margin-bottom: 12px;
        }
        .list-item:hover { background: var(--bg-surface-hover); border-color: var(--text-muted); }
        .list-icon { 
            width: 50px; height: 50px; border-radius: 14px; display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; flex-shrink: 0; background: var(--bg-surface-2); color: var(--text-muted);
        }
        .list-icon.primary { background: rgba(99,102,241,0.1); color: var(--primary); }
        .list-icon.accent { background: rgba(245,158,11,0.1); color: var(--accent); }
        .list-content h4 { margin: 0 0 4px; font-size: 1rem; font-weight: 700; }
        .list-content p { margin: 0; font-size: 0.85rem; color: var(--text-muted); }

        /* 4.5 Tabs */
        .tabs-container {
            display: flex; background: var(--bg-surface-2); padding: 5px; border-radius: 18px; margin-bottom: 25px;
            position: sticky; top: 85px; z-index: 50; box-shadow: var(--shadow-sm); border: var(--border);
        }
        .tab-btn {
            flex: 1; text-align: center; padding: 12px; border-radius: 14px; font-size: 0.95rem; font-weight: 700;
            color: var(--text-muted); cursor: pointer; transition: 0.3s;
        }
        .tab-btn.active { background: var(--bg-surface); color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

        /* =======================================================
           5. Ø§Ù„Ù‡ÙŠÙƒÙ„ (Layout & Navigation)
           ======================================================= */
        
        /* Top Header */
        .app-header {
            position: fixed; top: 0; left: 0; right: 0; height: var(--header-h);
            background: var(--bg-glass-strong); backdrop-filter: blur(20px);
            z-index: 1000; border-bottom: var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
            transform: translateY(0); transition: transform 0.3s;
        }
        .app-header.hidden { transform: translateY(-100%); }
        .logo { display: flex; align-items: center; gap: 10px; font-family: var(--font-ui); font-weight: 800; font-size: 1.4rem; color: var(--text-main); }
        .logo img { width: 36px; height: 36px; border-radius: 50%; box-shadow: 0 0 10px var(--primary-alpha); }

        /* Bottom Nav (Dock) */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; height: 75px;
            background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 24px;
            display: flex; justify-content: space-evenly; align-items: center;
            z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: bottom 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bottom-nav.hidden { bottom: -100px; }
        
        .nav-link {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-muted); font-size: 0.7rem; cursor: pointer;
            width: 60px; height: 100%; transition: 0.3s; position: relative;
        }
        .nav-link i { font-size: 1.4rem; margin-bottom: 4px; transition: 0.3s; }
        .nav-link.active { color: var(--primary); }
        .nav-link.active i { transform: translateY(-3px); }
        .nav-link.active::after { content:''; position: absolute; bottom: 10px; width: 5px; height: 5px; background: var(--primary); border-radius: 50%; }

        /* =======================================================
           6. Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Landing Page - Enhanced)
           ======================================================= */
        .landing-wrapper { text-align: center; padding: 40px 20px; animation: fadeInUp 0.8s; }
        .hero-logo { 
            width: 140px; height: 140px; margin: 0 auto 30px; border-radius: 50%;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 50px rgba(99,102,241,0.2); animation: float 6s infinite;
        }
        .hero-logo img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; }
        
        .hero-title { font-size: 3rem; margin-bottom: 10px; line-height: 1.1; }
        .hero-sub { font-size: 1.1rem; color: var(--text-muted); margin-bottom: 40px; max-width: 450px; margin-inline: auto; }

        /* Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª (Grid) */
        .features-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 30px 0; text-align: right; }
        .feature-item { 
            background: var(--bg-surface); padding: 20px; border-radius: 16px; border: var(--border);
            transition: 0.3s; text-align: center;
        }
        .feature-item:hover { border-color: var(--accent); transform: translateY(-5px); }
        .feature-item i { font-size: 2rem; color: var(--primary); margin-bottom: 10px; display: block; }
        .feature-item h3 { font-size: 1rem; margin-bottom: 5px; }
        .feature-item p { font-size: 0.8rem; color: var(--text-muted); margin: 0; }

        /* Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ© */
        .about-section { text-align: center; background: var(--bg-surface); border-radius: 20px; padding: 25px; margin: 30px 0; border: var(--border); }
        .about-section h3 { color: var(--accent); margin-bottom: 10px; font-size: 1.5rem; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¢Ø±Ø§Ø¡ (Testimonials Marquee) */
        .reviews-marquee { 
            overflow: hidden; width: 100%; margin-top: 40px; padding: 20px 0;
            background: linear-gradient(to right, transparent, var(--bg-surface), transparent);
        }
        .marquee-track { display: flex; gap: 20px; width: max-content; animation: scroll 25s linear infinite; }
        .review-card {
            background: var(--bg-surface-2); padding: 15px 20px; border-radius: 50px;
            display: flex; align-items: center; gap: 15px; min-width: 280px; border: 1px solid rgba(255,255,255,0.05);
        }
        .review-img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); background: var(--bg-surface); }
        .review-content p { margin: 0; font-size: 0.9rem; font-weight: 500; }
        .review-name { font-size: 0.75rem; color: var(--text-muted); }

        /* Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© (FAQ) */
        .faq-container { margin: 40px 0; text-align: right; }
        .faq-item { margin-bottom: 10px; border: var(--border); border-radius: 12px; overflow: hidden; background: var(--bg-surface); }
        .faq-question { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-family: var(--font-ui); }
        .faq-answer { padding: 15px; background: var(--bg-surface-2); font-size: 0.9rem; color: var(--text-muted); display: none; border-top: 1px solid rgba(255,255,255,0.05); }
        .faq-item.active .faq-answer { display: block; animation: slideDown 0.3s ease; }
        .faq-item.active .faq-question i { transform: rotate(180deg); transition: 0.3s; }

        /* =======================================================
           7. Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Auth Screens)
           ======================================================= */
        .auth-card { padding-top: 40px; animation: fadeInUp 0.6s; }
        .auth-header { text-align: center; margin-bottom: 40px; }
        .auth-header h2 { font-size: 2.2rem; margin-bottom: 10px; }

        /* =======================================================
           8. Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (App Views)
           ======================================================= */
        .profile-header {
            text-align: center; padding: 40px 20px; background: linear-gradient(to bottom, var(--bg-surface), transparent);
            margin: -20px -20px 20px -20px; border-bottom: 1px solid var(--border);
        }
        .profile-img-wrap {
            position: relative; width: 110px; height: 110px; margin: 0 auto 15px;
        }
        .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--bg-body); box-shadow: 0 0 0 2px var(--primary); }
        .edit-badge {
            position: absolute; bottom: 0; right: 0; background: var(--accent); color: white;
            width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: 3px solid var(--bg-body); cursor: pointer;
        }

        /* Calendar */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; margin-top: 10px; }
        .cal-day { padding: 10px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; transition: 0.2s; background: var(--bg-surface-2); }
        .cal-day:hover { background: var(--bg-surface-hover); }
        .cal-day.active { background: var(--primary); color: white; }

        /* Pomodoro Timer */
        .pomo-box { text-align: center; padding: 20px; background: var(--bg-surface); border-radius: 20px; margin-bottom: 20px; border: 1px solid var(--border-hover); }
        .pomo-time { font-size: 4rem; font-weight: 800; font-family: monospace; color: var(--primary-light); margin: 10px 0; text-shadow: 0 0 20px var(--primary-alpha); }

        /* =======================================================
           9. Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± (Store - NEW HOLOGRAPHIC DESIGN)
           ======================================================= */
        .pkg-grid { display: grid; gap: 25px; }
        
        .pkg-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‡ÙˆÙ„ÙˆØ¬Ø±Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
        .pkg-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.4);
        }
        
        /* Ø¨Ø·Ø§Ù‚Ø© Ù…Ù…ÙŠØ²Ø© */
        .pkg-card.featured {
            background: linear-gradient(145deg, rgba(99, 102, 241, 0.1), rgba(15, 23, 42, 0.8));
            border: 2px solid var(--primary);
        }
        .pkg-card.featured::before {
            content: "Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹";
            position: absolute;
            top: 15px;
            right: -30px;
            background: var(--primary);
            color: white;
            padding: 5px 30px;
            transform: rotate(45deg);
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .pkg-icon-wrap {
            width: 80px; height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .pkg-title { font-size: 1.5rem; font-weight: 800; margin: 0; color: var(--text-main); }
        .pkg-price { font-size: 2.8rem; font-weight: 900; color: var(--accent); margin: 15px 0; font-family: 'Cairo'; }
        .pkg-price span { font-size: 1rem; color: var(--text-muted); font-weight: 400; }
        
        .pkg-features { list-style: none; padding: 0; margin: 20px 0; width: 100%; text-align: right; }
        .pkg-features li { padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); color: var(--text-dim); display: flex; align-items: center; gap: 10px; }
        .pkg-features li:last-child { border-bottom: none; }
        .pkg-features i { color: var(--success); }

        .btn-pkg {
            width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s;
            border: none; margin-top: auto; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-pkg.primary { background: var(--primary); color: white; box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4); }
        .btn-pkg.primary:hover { background: var(--primary-dark); transform: scale(1.05); }
        .btn-pkg.glass { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }
        .btn-pkg.glass:hover { background: rgba(255,255,255,0.2); }

        /* Animations */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(50%); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Loader */
        #loader {
            position: fixed; inset: 0; background: var(--bg-body); z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .spinner { width: 60px; height: 60px; border: 5px solid var(--bg-surface-2); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Floating Support Chat */
        .support-fab {
            position: fixed; bottom: 100px; right: 20px; width: 50px; height: 50px;
            background: var(--success); color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 900;
            transition: 0.3s;
        }
        .support-fab:hover { transform: scale(1.1); }

    </style>
</head>
<body>

    <!-- Loader -->
    <div id="loader">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" style="position: fixed; top: 90px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 400px; pointer-events: none;"></div>

    <!-- Support Chat Button -->
    <div class="support-fab" onclick="window.open('https://wa.me/962799999999', '_blank')">
        <i class="fa-brands fa-whatsapp fa-xl"></i>
    </div>

    <!-- =========================================
         HEADER (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚)
         ========================================= -->
    <header id="main-header" class="app-header hidden">
        <div class="logo">
            <img src="https://i.ibb.co/VrJsk41/Gemini-Generated-Image-u0u4kwu0u4kwu0u4.png" alt="Logo">
            <span>Ù†Ø¨Ø±Ø§Ø³</span>
        </div>
        <div class="flex gap-2">
            <button class="btn-icon" onclick="utils.theme()"><i class="fa-solid fa-circle-half-stroke"></i></button>
            <button class="btn-icon text-danger" style="color:var(--danger)" onclick="auth.logout()"><i class="fa-solid fa-power-off"></i></button>
        </div>
    </header>

    <!-- =========================================
         1. LANDING SCREEN (Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø²ÙˆØ§Ø±)
         ========================================= -->
    <div id="landing-screen" class="container">
        <div class="landing-wrapper">
            <div class="hero-logo">
                <img src="https://i.ibb.co/VrJsk41/Gemini-Generated-Image-u0u4kwu0u4kwu0u4.png" alt="Nebras">
            </div>
            <h1 class="hero-title text-gradient font-ui">Ù†Ø¨Ø±Ø§Ø³ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h1>
            <p class="hero-sub">Ø¨ÙˆØ§Ø¨ØªÙƒ Ù„Ù„ØªÙ…ÙŠØ² Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ. Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø­Ø¯ÙŠØ«.</p>
            
            <div class="flex flex-col gap-3 w-full mt-4">
                <button class="btn btn-primary w-full" onclick="nav.to('login')">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ <i class="fa-solid fa-arrow-left"></i>
                </button>
                <button class="btn btn-accent w-full" onclick="nav.to('trial')">
                    <i class="fa-solid fa-stopwatch"></i> ØªØ¬Ø±Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ© (24 Ø³Ø§Ø¹Ø©)
                </button>
                <div class="flex gap-3 w-full">
                    <button class="btn btn-glass w-full" onclick="nav.to('register')">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
                    <button class="btn btn-glass w-full" onclick="nav.to('store-guest')">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</button>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª (Grid) -->
        <h3 class="text-center font-ui mt-4 mb-4 text-gradient" style="font-size: 1.8rem;">Ù„Ù…Ø§Ø°Ø§ Ù†Ø¨Ø±Ø§Ø³ØŸ</h3>
        <div class="features-grid">
            <div class="feature-item" data-aos="fade-up" data-aos-delay="100">
                <i class="fa-solid fa-brain"></i>
                <h3>ØªØ¹Ù„Ù… Ø°ÙƒÙŠ</h3>
                <p>Ø®Ø·Ø· Ø¯Ø±Ø§Ø³ÙŠØ© Ù…Ø®ØµØµØ©</p>
            </div>
            <div class="feature-item" data-aos="fade-up" data-aos-delay="200">
                <i class="fa-solid fa-chart-line"></i>
                <h3>ØªØªØ¨Ø¹ Ø§Ù„Ø£Ø¯Ø§Ø¡</h3>
                <p>ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ© ÙÙˆØ±ÙŠØ©</p>
            </div>
            <div class="feature-item" data-aos="fade-up" data-aos-delay="300">
                <i class="fa-solid fa-book-open"></i>
                <h3>Ù…Ø­ØªÙˆÙ‰ Ø´Ø§Ù…Ù„</h3>
                <p>ØªØºØ·ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ù…Ù†Ø§Ù‡Ø¬</p>
            </div>
            <div class="feature-item" data-aos="fade-up" data-aos-delay="400">
                <i class="fa-solid fa-certificate"></i>
                <h3>Ø´Ù‡Ø§Ø¯Ø§Øª</h3>
                <p>Ø¬ÙˆØ§Ø¦Ø² ØªÙ‚Ø¯ÙŠØ± Ù„Ù„Ù…ØªÙ…ÙŠØ²ÙŠÙ†</p>
            </div>
        </div>

        <!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© (FAQ) -->
        <div class="faq-container" data-aos="fade-up">
            <h3 class="font-ui mb-4 text-center">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h3>
            <div class="faq-item">
                <div class="faq-question" onclick="utils.toggleFaq(this)">ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØŸ <i class="fa-solid fa-chevron-down"></i></div>
                <div class="faq-answer">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±ØŒ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question" onclick="utils.toggleFaq(this)">Ù‡Ù„ ØªÙˆØ¬Ø¯ ØªØ¬Ø±Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ©ØŸ <i class="fa-solid fa-chevron-down"></i></div>
                <div class="faq-answer">Ù†Ø¹Ù…ØŒ Ù†ÙˆÙØ± ØªØ¬Ø±Ø¨Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø© Ù„ÙƒØ§Ù…Ù„ Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ù†ØµØ©.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question" onclick="utils.toggleFaq(this)">Ù…Ø§ Ù‡ÙŠ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ØŸ <i class="fa-solid fa-chevron-down"></i></div>
                <div class="faq-answer">Ù†Ù‚Ø¨Ù„ Ø²ÙŠÙ† ÙƒØ§Ø´ØŒ Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©ØŒ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ.</div>
            </div>
        </div>

        <!-- Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ© -->
        <div class="about-section" data-aos="fade-up">
            <h3>Ù…Ù† Ù†Ø­Ù†ØŸ</h3>
            <p class="text-muted text-sm" style="line-height: 1.8;">
                Ù†Ø­Ù† ÙØ±ÙŠÙ‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ù†Ø³Ø¹Ù‰ Ù„Ø¥Ø­Ø¯Ø§Ø« Ø«ÙˆØ±Ø© ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. ØªÙˆÙØ± Ù…Ù†ØµØ© Ù†Ø¨Ø±Ø§Ø³ Ø¨ÙŠØ¦Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø¢Ù…Ù†Ø© ÙˆÙ…Ø­ÙØ²Ø© ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‚ØµÙ‰ Ø¥Ù…ÙƒØ§Ù†Ø§ØªÙ‡Ù… Ù…Ù† Ø®Ù„Ø§Ù„ Ø£Ø¯ÙˆØ§Øª ØªÙ‚Ù†ÙŠØ© Ø­Ø¯ÙŠØ«Ø© ÙˆÙ…Ø­ØªÙˆÙ‰ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©.
            </p>
        </div>

        <!-- Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ (Marquee with Avatars) -->
        <h3 class="text-center font-ui mt-4">Ù‚ØµØµ Ù†Ø¬Ø§Ø­</h3>
        <div class="reviews-marquee">
            <div class="marquee-track">
                <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ù€ JS -->
            </div>
        </div>
        
        <div class="text-center mt-4 mb-4 py-5">
            <p class="text-muted text-sm">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ù†Ø¨Ø±Ø§Ø³ 2026</p>
        </div>
    </div>

    <!-- =========================================
         2. AUTH SCREENS (ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„ØªØ³Ø¬ÙŠÙ„)
         ========================================= -->
    <div id="auth-container" class="container hidden" style="padding-top: 40px;">
        <button class="btn-icon mb-4" onclick="nav.to('landing')"><i class="fa-solid fa-arrow-right"></i></button>

        <!-- Login -->
        <div id="view-login" class="auth-card hidden">
            <div class="auth-header">
                <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <p class="text-muted">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! ØªØ§Ø¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ Ø§Ù„Ø¢Ù†.</p>
            </div>
            <div class="input-wrap">
                <i class="fa-regular fa-envelope input-icon"></i>
                <input type="email" id="log-email" class="form-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" dir="ltr">
            </div>
            <div class="input-wrap">
                <i class="fa-regular fa-lock input-icon"></i>
                <input type="password" id="log-pass" class="form-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" dir="ltr">
            </div>
            <button class="btn btn-primary w-full" onclick="auth.login()">Ø¯Ø®ÙˆÙ„</button>
            <p class="text-center mt-4 text-sm text-muted">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span class="text-accent" style="cursor:pointer" onclick="nav.to('register')">Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹</span></p>
        </div>

        <!-- Register -->
        <div id="view-register" class="auth-card hidden">
            <div class="text-center mb-4">
                <div style="width:110px; height:110px; background:var(--bg-surface-2); border-radius:50%; margin:0 auto; display:flex; align-items:center; justify-content:center; cursor:pointer; overflow:hidden; border:2px dashed var(--text-muted); position:relative" onclick="document.getElementById('reg-img').click()">
                    <img id="reg-preview" src="" style="width:100%; height:100%; object-fit:cover; display:none">
                    <i id="reg-icon" class="fa-solid fa-camera fa-2x text-muted"></i>
                </div>
                <input type="file" id="reg-img" hidden onchange="utils.preview(this)">
                <p class="text-xs text-muted mt-2">Ø§Ø®ØªØ± ØµÙˆØ±ØªÙƒ Ø§Ù„Ø±Ù…Ø²ÙŠØ©</p>
            </div>
            <div class="input-wrap"><input id="reg-code" class="form-input" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„"></div>
            <div class="input-wrap"><input id="reg-name" class="form-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ"></div>
            <div class="input-wrap"><input id="reg-phone" class="form-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"></div>
            <div class="input-wrap"><input id="reg-email" class="form-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯" dir="ltr"></div>
            <div class="input-wrap"><input id="reg-pass" class="form-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" dir="ltr"></div>
            <button class="btn btn-primary w-full" onclick="auth.register()">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        </div>

        <!-- Trial -->
        <div id="view-trial" class="auth-card hidden">
            <div class="card text-center" style="border-color: var(--accent);">
                <i class="fa-solid fa-gift text-accent" style="font-size:3rem; margin-bottom:15px"></i>
                <h3 class="font-ui">ØªØ¬Ø±Ø¨Ø© 24 Ø³Ø§Ø¹Ø©</h3>
                <p class="text-muted text-sm">ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ù…Ø¬Ø§Ù†Ø§Ù‹</p>
            </div>
            <div class="input-wrap"><input id="trial-name" class="form-input" placeholder="Ø§Ù„Ø§Ø³Ù…"></div>
            <div class="input-wrap"><input id="trial-phone" class="form-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"></div>
            <div class="input-wrap"><select id="trial-class" class="form-input"><option disabled selected>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option></select></div>
            <div class="input-wrap"><input id="trial-email" class="form-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯" dir="ltr"></div>
            <button class="btn btn-accent w-full" onclick="auth.trial()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
        </div>

        <!-- Guest Store -->
        <div id="view-store-guest" class="auth-card hidden">
            <h3 class="text-center font-ui mb-4">Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
            
            <div class="pkg-grid">
                <!-- Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© -->
                <div class="pkg-card featured" data-tilt>
                    <div class="pkg-icon-wrap"><i class="fa-solid fa-crown text-accent text-3xl"></i></div>
                    <h3 class="pkg-title">Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø³ÙŠØ©</h3>
                    <p class="text-sm text-muted">Ø§Ù„Ø­Ù„ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„ØªÙÙˆÙ‚ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</p>
                    <div class="pkg-price">25 <span>JOD</span></div>
                    
                    <ul class="pkg-features">
                        <li><i class="fa-solid fa-circle-check"></i> ÙØªØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</li>
                        <li><i class="fa-solid fa-circle-check"></i> Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠ (AI)</li>
                        <li><i class="fa-solid fa-circle-check"></i> Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…ÙƒØ«ÙØ©</li>
                        <li><i class="fa-solid fa-circle-check"></i> ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</li>
                    </ul>
                    
                    <div class="input-wrap mb-2">
                        <input class="form-input text-center text-sm" placeholder="ÙƒÙˆØ¯ Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" id="promo-gold">
                    </div>
                    
                    <button class="btn-pkg primary" onclick="utils.buy('Ø§Ù„Ù…Ø§Ø³ÙŠØ©', '25', document.getElementById('promo-gold').value)">
                        <i class="fa-brands fa-whatsapp"></i> Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†
                    </button>
                </div>

                <!-- Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø¯Ø© -->
                <div class="pkg-card" data-tilt>
                    <div class="pkg-icon-wrap"><i class="fa-solid fa-layer-group text-primary text-2xl"></i></div>
                    <h3 class="pkg-title">Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø¯Ø©</h3>
                    <p class="text-sm text-muted">ØªØ±ÙƒÙŠØ² ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div class="pkg-price">10 <span>JOD</span></div>
                    
                    <ul class="pkg-features">
                        <li><i class="fa-solid fa-circle-check"></i> Ø´Ø±Ø­ ÙƒØ§Ù…Ù„ Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©</li>
                        <li><i class="fa-solid fa-circle-check"></i> Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙˆØ£ÙˆØ±Ø§Ù‚ Ø¹Ù…Ù„</li>
                    </ul>
                    
                    <button class="btn-pkg glass" onclick="utils.buy('Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©', '10')">
                        <i class="fa-brands fa-whatsapp"></i> Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- =========================================
         3. Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ (Main App)
         ========================================= -->
    <div id="main-app" class="container hidden" style="padding-top: 80px;">
        
        <!-- Tab: Home -->
        <div id="tab-home" class="hidden">
            <!-- Welcome Card -->
            <div class="card" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; border: none; padding: 25px;">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="font-ui m-0 text-2xl">Ø£Ù‡Ù„Ø§Ù‹ØŒ <span id="u-name">...</span> ğŸ‘‹</h2>
                        <p class="text-sm opacity-90 mt-1">Ø§Ù„ØµÙ: <span id="u-class">...</span></p>
                    </div>
                    <div style="text-align: center;">
                        <div class="avatar-tile" style="background: rgba(255,255,255,0.2); color: white; width: 60px; height: 60px; border-radius: 18px; font-size: 1.5rem;">
                            <span class="font-ui fw-bold" id="u-lvl">1</span>
                        </div>
                        <span class="text-xs mt-1 block opacity-80">Level</span>
                    </div>
                </div>
                <div class="flex gap-3 mt-5">
                    <div class="w-full bg-glass p-3 rounded-lg text-center backdrop-blur-md border border-white/10">
                        <span class="block font-bold text-xl" id="st-ex">0</span>
                        <span class="text-xs opacity-80">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</span>
                    </div>
                    <div class="w-full bg-glass p-3 rounded-lg text-center backdrop-blur-md border border-white/10">
                        <span class="block font-bold text-xl" id="st-avg">0%</span>
                        <span class="text-xs opacity-80">Ø§Ù„Ù…Ø¹Ø¯Ù„</span>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Mini -->
            <div class="card mt-4 p-4">
                <div class="card-header">
                    <h3 class="card-title text-accent"><i class="fa-solid fa-trophy mr-2"></i> Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</h3>
                    <span class="text-xs text-primary cursor-pointer">Ø§Ù„Ù…Ø²ÙŠØ¯</span>
                </div>
                <div id="mini-leaderboard" class="flex flex-col gap-2">
                    <!-- JS Populated -->
                </div>
            </div>

            <h3 class="font-ui text-lg mb-3 mt-5 text-primary">Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h3>
            <div id="home-list" class="flex flex-col gap-3">
                <!-- List Items JS -->
            </div>
        </div>

        <!-- Tab: Library -->
        <div id="tab-library" class="hidden">
            <div class="tabs-container">
                <div class="tab-btn active" onclick="ui.seg('lib','exams',this)">Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</div>
                <div class="tab-btn" onclick="ui.seg('lib','assign',this)">ÙˆØ§Ø¬Ø¨Ø§Øª</div>
                <div class="tab-btn" onclick="ui.seg('lib','files',this)">Ù…ØµØ§Ø¯Ø±</div>
            </div>

            <div id="seg-lib-exams">
                <div id="exams-empty" class="text-center py-5 text-muted">
                    <i class="fa-regular fa-folder-open" style="font-size:3.5rem; opacity:0.3; margin-bottom:15px; display:block"></i>
                    <p>Ø§Ø®ØªØ± Ù…Ø§Ø¯Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                </div>
                <div id="exams-content" class="flex flex-col gap-3"></div>
            </div>

            <div id="seg-lib-assign" class="hidden">
                <div class="card">
                    <h3 class="font-ui text-md mb-4">Ø±ÙØ¹ ÙˆØ§Ø¬Ø¨</h3>
                    <div class="input-wrap"><select id="as-type" class="form-input"><option>ÙˆØ±Ù‚Ø© Ø¹Ù…Ù„</option><option>Ù…Ø´Ø±ÙˆØ¹</option></select></div>
                    <div class="input-wrap"><textarea id="as-desc" class="form-input" rows="4" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></textarea></div>
                    <div onclick="document.getElementById('as-file').click()" class="text-center p-5 border-dashed rounded-lg mb-4 cursor-pointer bg-surface-2 transition hover:bg-surface-hover" style="border: 2px dashed var(--text-muted);">
                        <i class="fa-solid fa-cloud-arrow-up text-3xl text-primary mb-3"></i>
                        <p class="text-sm text-muted" id="as-name">Ø§Ø®ØªØ± Ù…Ù„Ù (PDF, IMG)</p>
                        <input type="file" id="as-file" hidden onchange="utils.handleFile(this)">
                    </div>
                    <button class="btn btn-primary w-full" onclick="app.upload()">Ø¥Ø±Ø³Ø§Ù„</button>
                </div>
            </div>

            <div id="seg-lib-files" class="hidden flex flex-col gap-3" id="files-content"></div>
        </div>

        <!-- Tab: Tools -->
        <div id="tab-tools" class="hidden">
            <div class="tabs-container">
                <div class="tab-btn active" onclick="ui.seg('tool','cal',this)">Ø§Ù„ØªÙ‚ÙˆÙŠÙ…</div>
                <div class="tab-btn" onclick="ui.seg('tool','pomo',this)">Ù…Ø¤Ù‚Øª</div>
                <div class="tab-btn" onclick="ui.seg('tool','notes',this)">Ù…ÙÙƒØ±Ø©</div>
            </div>
            
            <div id="seg-tool-cal">
                <div class="card text-center p-4">
                    <h3 class="font-ui mb-3 text-accent">Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</h3>
                    <div class="flex justify-between mb-3 px-2">
                        <span class="font-bold">ÙŠÙ†Ø§ÙŠØ± 2026</span>
                        <div class="flex gap-2">
                            <i class="fa-solid fa-chevron-right text-muted cursor-pointer"></i>
                            <i class="fa-solid fa-chevron-left text-muted cursor-pointer"></i>
                        </div>
                    </div>
                    <div id="calendar-grid" class="calendar-grid"></div>
                </div>
                <h4 class="font-ui text-sm mb-2 mt-4 text-muted">Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h4>
                <div id="calendar-events" class="flex flex-col gap-2">
                    <div class="list-item">
                        <div class="list-icon primary"><i class="fa-solid fa-calendar-day"></i></div>
                        <div class="list-content">
                            <h4>Ø§Ù…ØªØ­Ø§Ù† Ø±ÙŠØ§Ø¶ÙŠØ§Øª</h4>
                            <p>Ø§Ù„Ø£Ø­Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ù… - Ø§Ù„Ø³Ø§Ø¹Ø© 10:00</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Pomodoro Tool -->
            <div id="seg-tool-pomo" class="hidden">
                <div class="pomo-box">
                    <h3 class="font-ui text-muted text-sm">ÙˆÙ‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²</h3>
                    <div class="pomo-time" id="pomo-display">25:00</div>
                </div>
                <div class="flex gap-3 justify-center">
                    <button class="btn btn-primary" onclick="app.pomoStart()">Ø§Ø¨Ø¯Ø£</button>
                    <button class="btn btn-glass" onclick="app.pomoReset()">Ø¥Ø¹Ø§Ø¯Ø©</button>
                </div>
            </div>

            <div id="seg-tool-notes" class="hidden">
                <div class="card p-0 overflow-hidden">
                    <textarea id="my-notes" class="w-full p-4 bg-transparent border-none resize-none text-main" rows="16" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..." style="width:100%; border:none; background:transparent; padding:20px; color:var(--text-main); font-family:inherit; line-height:1.6"></textarea>
                    <div class="p-3 border-t border-color bg-surface-2" style="padding:15px; border-top:1px solid var(--border)">
                        <button class="btn btn-sm btn-primary w-full" onclick="app.saveNotes()">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Store -->
        <div id="tab-store" class="hidden">
            <h3 class="text-center font-ui mb-4">Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h3>
            <!-- Ù†Ø³Ø® Ù†ÙØ³ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ØªØ¬Ø± Ù„Ù„Ø²ÙˆØ§Ø± -->
             <div class="pkg-grid">
                <div class="pkg-card featured" data-tilt>
                    <div class="pkg-icon-wrap"><i class="fa-solid fa-crown text-accent text-3xl"></i></div>
                    <h3 class="pkg-title">Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø³ÙŠØ©</h3>
                    <p class="text-sm text-muted">Ø§Ù„Ø­Ù„ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„ØªÙÙˆÙ‚ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</p>
                    <div class="pkg-price">25 <span>JOD</span></div>
                    
                    <ul class="pkg-features">
                        <li><i class="fa-solid fa-circle-check"></i> ÙØªØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</li>
                        <li><i class="fa-solid fa-circle-check"></i> Ø¨Ù†Ùƒ Ø£Ø³Ø¦Ù„Ø© Ø°ÙƒÙŠ (AI)</li>
                        <li><i class="fa-solid fa-circle-check"></i> Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…ÙƒØ«ÙØ©</li>
                    </ul>
                    
                    <div class="input-wrap mb-2">
                        <input class="form-input text-center text-sm" placeholder="ÙƒÙˆØ¯ Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" id="promo-gold-in">
                    </div>
                    
                    <button class="btn-pkg primary" onclick="utils.buy('Ø§Ù„Ù…Ø§Ø³ÙŠØ©', '25', document.getElementById('promo-gold-in').value)">
                        <i class="fa-brands fa-whatsapp"></i> Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†
                    </button>
                </div>

                <div class="pkg-card" data-tilt>
                    <div class="pkg-icon-wrap"><i class="fa-solid fa-layer-group text-primary text-2xl"></i></div>
                    <h3 class="pkg-title">Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø¯Ø©</h3>
                    <p class="text-sm text-muted">ØªØ±ÙƒÙŠØ² ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©</p>
                    <div class="pkg-price">10 <span>JOD</span></div>
                    
                    <ul class="pkg-features">
                        <li><i class="fa-solid fa-circle-check"></i> Ø´Ø±Ø­ ÙƒØ§Ù…Ù„ Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©</li>
                        <li><i class="fa-solid fa-circle-check"></i> Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙˆØ£ÙˆØ±Ø§Ù‚ Ø¹Ù…Ù„</li>
                    </ul>
                    
                    <button class="btn-pkg glass" onclick="utils.buy('Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø©', '10')">
                        <i class="fa-brands fa-whatsapp"></i> Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab: Profile -->
        <div id="tab-profile" class="hidden">
            <div class="profile-header">
                <div class="profile-img-wrap">
                    <img id="profile-img" src="">
                    <div class="edit-badge" onclick="document.getElementById('edit-pic').click()"><i class="fa-solid fa-pen"></i></div>
                    <input type="file" id="edit-pic" hidden onchange="actions.updatePic(this)">
                </div>
                <h3 id="p-name" class="font-ui m-0 text-xl">...</h3>
                <p id="p-class" class="text-muted text-sm mt-1">...</p>
            </div>
            
            <div class="card mt-4 p-4">
                <h4 class="font-ui text-sm mb-3 text-muted">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</h4>
                <canvas id="chart-canvas" height="200"></canvas>
            </div>
            
            <h4 class="font-ui text-sm mb-2 mt-5 px-2">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ø®ÙŠØ±</h4>
            <div id="history-list" class="flex flex-col gap-2"></div>
            
            <button class="btn btn-glass w-full mt-5 text-danger border-danger/20 hover:bg-danger/10" onclick="auth.logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>

    </div>

    <!-- Bottom Navigation Bar -->
    <nav id="bottom-nav" class="bottom-nav hidden">
        <div class="nav-link active" onclick="ui.tab('home', this)">
            <i class="fa-solid fa-house"></i>
            <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </div>
        <div class="nav-link" onclick="ui.tab('library', this)">
            <i class="fa-solid fa-book-open"></i>
            <span>Ø§Ù„Ù…ÙƒØªØ¨Ø©</span>
        </div>
        <div class="nav-link" onclick="ui.tab('tools', this)">
            <i class="fa-solid fa-layer-group"></i>
            <span>Ø§Ù„Ø£Ø¯ÙˆØ§Øª</span>
        </div>
        <div class="nav-link" onclick="ui.tab('store', this)">
            <i class="fa-solid fa-bag-shopping"></i>
            <span>Ø§Ù„Ù…ØªØ¬Ø±</span>
        </div>
        <div class="nav-link" onclick="ui.tab('profile', this)">
            <i class="fa-solid fa-user"></i>
            <span>Ø­Ø³Ø§Ø¨ÙŠ</span>
        </div>
    </nav>

    <!-- Exam Overlay -->
    <div id="exam-overlay" class="hidden" style="position:fixed; inset:0; background:var(--bg-body); z-index:5000; display:flex; flex-direction:column;">
        <div class="flex justify-between items-center p-4 border-b border-color bg-surface">
            <div>
                <h3 id="ex-title" class="font-ui m-0 text-primary text-md">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h3>
                <span class="text-xs text-muted"><span id="q-idx">1</span> / <span id="q-total">10</span></span>
            </div>
            <div id="ex-timer" class="bg-danger text-white px-3 py-1 rounded-full text-sm font-bold flex items-center gap-2">
                <i class="fa-regular fa-clock"></i> 00:00
            </div>
        </div>
        <div style="height:4px; background:var(--bg-surface-2); width:100%"><div id="ex-prog" style="height:100%; width:0%; background:var(--primary); transition:width 0.3s"></div></div>
        
        <div class="flex-1 overflow-y-auto p-5">
            <div class="card text-center py-6 border-primary/20 shadow-lg">
                <h3 id="q-txt" class="text-lg leading-relaxed m-0 font-ui"></h3>
                <div id="q-img" class="mt-4 rounded-lg overflow-hidden"></div>
            </div>
            <div id="q-opts" class="flex flex-col gap-3"></div>
        </div>
        
        <div class="p-4 border-t border-color bg-surface flex justify-between">
            <button class="btn btn-ghost btn-sm px-4" onclick="exam.nav(-1)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button class="btn btn-ghost btn-sm text-danger border-danger/30 px-4" onclick="exam.quit()">Ø®Ø±ÙˆØ¬</button>
            <button class="btn btn-primary btn-sm px-6" onclick="exam.nav(1)" id="btn-next">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
    </div>

<script>
    // ==================== CONFIGURATION ====================
    const ADMIN_NUMBER = "962799999999"; // Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯ÙŠØ± - Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    const CFG = {
        api: "https://script.google.com/macros/s/AKfycbyJ8FX2Hd_OAakWU0Gbo35jcLq5b-tjwGdoGb4RimJtJCfgZqWnM4OSa7kGV-usUwgX/exec",
        defImg: "https://api.dicebear.com/7.x/bottts/svg?seed=user",
        // Updated Avatars (Cartoon/Random)
        avatars: [
            "https://api.dicebear.com/7.x/micah/svg?seed=Felix",
            "https://api.dicebear.com/7.x/micah/svg?seed=Aneka",
            "https://api.dicebear.com/7.x/micah/svg?seed=Willow",
            "https://api.dicebear.com/7.x/micah/svg?seed=Milo",
            "https://api.dicebear.com/7.x/micah/svg?seed=Zoe",
            "https://api.dicebear.com/7.x/micah/svg?seed=Caleb"
        ]
    };

    let STATE = {
        token: localStorage.getItem('tk'),
        user: { name: localStorage.getItem('nm'), class: localStorage.getItem('cl'), photo: localStorage.getItem('ph') },
        did: localStorage.getItem('did') || 'dev_'+Date.now(),
        data: { subs: [], tasks: JSON.parse(localStorage.getItem('tasks')||'[]') },
        exam: { on: false, data: [], ans: {}, idx: 0, time: null, sec: 0 },
        tmp: {},
        pomo: { timer: null, sec: 1500, active: false }
    };
    if(!localStorage.getItem('did')) localStorage.setItem('did', STATE.did);

    // ==================== INITIALIZATION ====================
    window.onload = () => {
        if(localStorage.getItem('theme')=='light') utils.toggleTheme(false);
        
        // Populate Reviews with Random Avatars & Arabic Names
        const reviews = [
            { name: "Ø³Ø§Ù„Ù… Ø§Ù„Ø¹Ù…Ø±ÙŠ", text: "Ù…Ù†ØµØ© Ù…Ù…ØªØ§Ø²Ø© Ø¬Ø¯Ø§Ù‹ Ø³Ø§Ø¹Ø¯ØªÙ†ÙŠ ÙÙŠ Ø§Ù„ÙÙ‡Ù…!" },
            { name: "Ù†ÙˆØ± Ø§Ù„Ù‡Ø¯Ù‰", text: "Ø£ÙØ¶Ù„ Ù…Ù†ØµØ© Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø¹Ù† Ø¨Ø¹Ø¯ Ø¨Ù„Ø§ Ù…Ù†Ø§Ø²Ø¹." },
            { name: "ÙƒØ±ÙŠÙ… ÙŠÙˆØ³Ù", text: "Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù‚Ø¹ÙŠØ© ÙˆÙ…ÙÙŠØ¯Ø© Ù„Ù„ØºØ§ÙŠØ©." },
            { name: "Ø¬Ù†Ù‰ Ù…Ø­Ù…Ø¯", text: "Ø§Ù„ØªØµÙ…ÙŠÙ… Ø±Ø§Ø¦Ø¹ ÙˆØ³Ù‡Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…." },
            { name: "Ø¹Ù…Ø± Ø§Ù„ÙØ§Ø±ÙˆÙ‚", text: "Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ… Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ø±Ø§Ø¦Ø¹." },
            { name: "Ù„ÙŠØ§Ù† Ø§Ù„Ø£Ø­Ù…Ø¯", text: "ØªØ¬Ø±Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ø§ Ù…Ø«ÙŠÙ„ Ù„Ù‡Ø§." }
        ];
        
        const track = document.querySelector('.marquee-track');
        [...reviews, ...reviews].forEach((r, i) => {
            let img = CFG.avatars[i % CFG.avatars.length];
            track.innerHTML += `
                <div class="review-card">
                    <img src="${img}" class="review-img">
                    <div class="review-content">
                        <p>"${r.text}"</p>
                        <span class="review-name">${r.name}</span>
                    </div>
                </div>
            `;
        });

        // Routing Logic
        if(STATE.token) {
            app.init(); 
        } else {
            document.getElementById('loader').style.display='none';
            document.getElementById('landing-screen').classList.remove('hidden');
        }

        const p = new URLSearchParams(window.location.search).get('exam');
        if(p) sessionStorage.setItem('p_exam', p);
        
        AOS.init();
    };

    // ==================== UTILS ====================
    const utils = {
        loader: (s) => document.getElementById('loader').style.display = s?'flex':'none',
        api: async (act, dt={}) => {
            dt.action = act;
            try { return await (await fetch(CFG.api, {method:'POST', body:JSON.stringify(dt)})).json(); }
            catch { return {success:false, message:'Ø®Ø·Ø£ Ø§ØªØµØ§Ù„'}; }
        },
        toggleTheme: (t=true) => {
            let b = document.body;
            let n = t ? (b.getAttribute('data-theme')=='light'?'dark':'light') : 'light';
            b.setAttribute('data-theme', n); localStorage.setItem('theme', n);
        },
        preview: (i) => {
            if(i.files[0]) {
                let r = new FileReader();
                r.onload = e => {
                    STATE.tmp.photo = e.target.result;
                    document.getElementById('reg-preview').src = e.target.result;
                    document.getElementById('reg-preview').style.display='block';
                    document.getElementById('reg-icon').style.display='none';
                }; r.readAsDataURL(i.files[0]);
            }
        },
        handleFile: (i) => {
            if(i.files[0]) {
                document.getElementById('as-name').innerText = i.files[0].name;
                let r = new FileReader();
                r.onload = e => STATE.tmp.file = {d:e.target.result, n:i.files[0].name};
                r.readAsDataURL(i.files[0]);
            }
        },
        buy: (n, p, promo) => {
            let text = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø¨Ø§Ù‚Ø© ${n} Ø¨Ø³Ø¹Ø± ${p}`;
            if(promo) text += `\nÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…: ${promo}`;
            window.open(`https://wa.me/${ADMIN_NUMBER}?text=${encodeURIComponent(text)}`, '_blank');
        },
        toggleFaq: (el) => {
            el.parentElement.classList.toggle('active');
        }
    };

    // ==================== NAV ====================
    const nav = {
        to: (v) => {
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('main-header').classList.add('hidden');
            document.getElementById('bottom-nav').classList.add('hidden');

            if (v === 'landing') {
                document.getElementById('landing-screen').classList.remove('hidden');
            } else if (['login','register','trial','store-guest'].includes(v)) {
                document.getElementById('auth-container').classList.remove('hidden');
                ['view-login','view-register','view-trial','view-store-guest'].forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.classList.add('hidden');
                });
                
                const targetView = document.getElementById('view-'+v);
                if(targetView) targetView.classList.remove('hidden');
                
                if(v=='trial') auth.loadClasses();
            }
        }
    };

    const ui = {
        tab: (id, el) => {
            document.querySelectorAll('#main-app > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('tab-'+id).classList.remove('hidden');
            document.querySelectorAll('.nav-link').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            window.scrollTo(0,0);
        },
        seg: (p, id, el) => {
            document.querySelectorAll(`[id^="seg-${p}-"]`).forEach(s => s.classList.add('hidden'));
            document.getElementById(`seg-${p}-${id}`).classList.remove('hidden');
            el.parentElement.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }
    };

    // ==================== AUTH ====================
    const auth = {
        login: async () => {
            let e = document.getElementById('log-email').value, p = document.getElementById('log-pass').value;
            if(!e||!p) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡','Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©','warning');
            utils.loader(1);
            let r = await utils.api('loginUser', {email:e, pass:p, deviceId:STATE.did});
            utils.loader(0);
            if(r.success) auth.save(r); else Swal.fire('Ø®Ø·Ø£',r.message,'error');
        },
        register: async () => {
            let d = {
                code: document.getElementById('reg-code').value, name: document.getElementById('reg-name').value,
                phone: document.getElementById('reg-phone').value, email: document.getElementById('reg-email').value,
                password: document.getElementById('reg-pass').value, photoData: STATE.tmp.photo, deviceId: STATE.did
            };
            if(!d.code) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡','Ø§Ù„ÙƒÙˆØ¯ Ù…Ø·Ù„ÙˆØ¨','warning');
            utils.loader(1);
            let r = await utils.api('registerStudent', {d:d});
            utils.loader(0);
            if(r.success) auth.save(r); else Swal.fire('Ø®Ø·Ø£',r.message,'error');
        },
        trial: async () => {
            let d = {
                name: document.getElementById('trial-name').value, phone: document.getElementById('trial-phone').value,
                classLevel: document.getElementById('trial-class').value, email: document.getElementById('trial-email').value, deviceId: STATE.did
            };
            if(!d.name) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡','Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨','warning');
            utils.loader(1);
            let r = await utils.api('createTrialAccount', {d:d});
            utils.loader(0);
            if(r.success) { Swal.fire('ØªÙ…','ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: '+r.tempPass,'success').then(()=>auth.save(r)); }
            else Swal.fire('Ø®Ø·Ø£',r.message,'error');
        },
        save: (r) => {
            localStorage.setItem('tk', r.token); localStorage.setItem('nm', r.name);
            localStorage.setItem('cl', r.classLevel); if(r.photo) localStorage.setItem('ph', r.photo);
            STATE.token = r.token; STATE.user = {name:r.name, class:r.classLevel, photo:r.photo};
            app.init();
        },
        loadClasses: async () => {
            let r = await utils.api('getPublicData');
            if(r.classes) document.getElementById('trial-class').innerHTML = '<option disabled selected>Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>' + r.classes.map(c=>`<option>${c}</option>`).join('');
        },
        logout: () => { localStorage.clear(); location.reload(); }
    };

    // ==================== APP LOGIC ====================
    const app = {
        init: () => {
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('main-header').classList.remove('hidden');
            document.getElementById('bottom-nav').classList.remove('hidden');
            document.getElementById('loader').style.display = 'none';
            
            document.getElementById('u-name').innerText = STATE.user.name;
            document.getElementById('p-name').innerText = STATE.user.name;
            document.getElementById('u-class').innerText = STATE.user.class;
            document.getElementById('p-class').innerText = STATE.user.class;
            document.getElementById('profile-img').src = STATE.user.photo || CFG.defImg;
            
            ui.tab('home', document.querySelector('.nav-link'));

            app.loadData();
            app.renderTasks();
            app.renderCal();
            app.renderLeaderboard();
            
            let p = sessionStorage.getItem('p_exam');
            if(p) { sessionStorage.removeItem('p_exam'); exam.start(p); }
        },
        loadData: async () => {
            let r1 = await utils.api('getExamsList', {token:STATE.token});
            if(r1.subjects) {
                STATE.data.subs = r1.subjects;
                app.renderHome();
                document.getElementById('st-ex').innerText = r1.subjects.reduce((a,s)=>a+s.exams.length,0);
            }
            let r2 = await utils.api('getStudentStats', {token:STATE.token});
            if(r2.success) {
                document.getElementById('st-avg').innerText = r2.myAvg + '%';
                document.getElementById('u-lvl').innerText = Math.floor(r2.myAvg / 20) + 1;
                app.renderHist(r2.history);
                app.renderChart(r2.myAvg, r2.classAvg);
            }
            let r3 = await utils.api('getLibraryContent', {token:STATE.token});
            if(r3.library) app.renderLib(r3.library);
        },
        renderHome: () => {
            let h='';
            STATE.data.subs.forEach(s => {
                h += `<div class="list-item" onclick="app.openSub('${s.name}')">
                        <div class="list-icon primary"><i class="fa-solid fa-book"></i></div>
                        <div class="list-content">
                            <h4>${s.name}</h4>
                            <p>${s.exams.length} Ø§Ø®ØªØ¨Ø§Ø±</p>
                        </div>
                        <i class="fa-solid fa-chevron-left text-muted text-sm"></i>
                      </div>`;
            });
            document.getElementById('home-list').innerHTML = h;
        },
        renderLeaderboard: () => {
            // Mock Leaderboard
            const leaders = [
                {name:"ÙŠØ²Ù† Ù…Ø­Ù…ÙˆØ¯", score:99, img:CFG.avatars[3]},
                {name:"Ù„ÙŠÙ† Ø³Ø§Ù…Ø±", score:97, img:CFG.avatars[4]},
                {name:"ÙƒØ±Ù… Ù‡Ø§Ù†ÙŠ", score:95, img:CFG.avatars[5]}
            ];
            let h = '';
            leaders.forEach((l, i) => {
                h += `<div class="list-item" style="padding:10px">
                        <div class="text-accent fw-bold text-lg" style="width:25px">#${i+1}</div>
                        <img src="${l.img}" style="width:35px;height:35px;border-radius:50%;border:1px solid var(--border-hover)">
                        <div class="list-content"><h4>${l.name}</h4></div>
                        <div class="text-success fw-bold">${l.score}%</div>
                      </div>`;
            });
            document.getElementById('mini-leaderboard').innerHTML = h;
        },
        renderCal: () => {
            let h = '';
            for(let i=1; i<=7; i++) {
                h += `<div class="cal-day ${i==4?'active':''}" style="padding:10px; border:1px solid var(--border); border-radius:10px; font-weight:bold">${i}</div>`;
            }
            document.getElementById('calendar-grid').innerHTML = h;
        },
        openSub: (n) => {
            ui.tab('library', document.querySelectorAll('.nav-link')[1]);
            ui.seg('lib', 'exams', document.querySelectorAll('#tab-library .tab-btn')[0]);
            document.getElementById('exams-empty').classList.add('hidden');
            let sub = STATE.data.subs.find(s=>s.name==n);
            let h = `<h4 class="font-ui text-primary mb-4">${n}</h4>`;
            sub.exams.forEach(x => {
                h += `<div class="list-item" onclick="exam.start('${x.title}')">
                        <div class="list-icon accent"><i class="fa-solid fa-pen-to-square"></i></div>
                        <div class="list-content">
                            <h4>${x.title}</h4>
                            <p>${x.duration} Ø¯</p>
                        </div>
                        <button class="btn btn-primary btn-sm" style="padding:5px 12px">Ø§Ø¨Ø¯Ø£</button>
                      </div>`;
            });
            document.getElementById('exams-content').innerHTML = h;
        },
        renderLib: (l) => {
            let h='';
            l.forEach(f => {
                h += `<a href="${f.link}" target="_blank" class="list-item">
                        <div class="list-icon text-success" style="background:var(--bg-surface-hover)"><i class="fa-solid fa-file-arrow-down"></i></div>
                        <div class="list-content">
                            <h4>${f.title}</h4>
                            <p>${f.date}</p>
                        </div>
                      </a>`;
            });
            document.getElementById('files-content').innerHTML = h;
        },
        renderTasks: () => {
            let h='';
            STATE.data.tasks.forEach((t,i) => {
                h += `<div class="list-item">
                        <input type="checkbox" ${t.done?'checked':''} onchange="app.togTask(${i})">
                        <div class="list-content mx-2" style="text-decoration:${t.done?'line-through':''}; opacity:${t.done?0.5:1}">${t.txt}</div>
                        <i class="fa-solid fa-trash text-danger cursor-pointer" onclick="app.delTask(${i})"></i>
                      </div>`;
            });
            document.getElementById('tasks-list').innerHTML = h || '<p class="text-center text-muted text-sm">Ù„Ø§ Ù…Ù‡Ø§Ù…</p>';
        },
        togTask: (i) => { STATE.data.tasks[i].done=!STATE.data.tasks[i].done; localStorage.setItem('tasks', JSON.stringify(STATE.data.tasks)); app.renderTasks(); },
        delTask: (i) => { STATE.data.tasks.splice(i,1); localStorage.setItem('tasks', JSON.stringify(STATE.data.tasks)); app.renderTasks(); },
        addTask: () => {
            let v = document.getElementById('new-task').value;
            if(v) { STATE.data.tasks.push({txt:v, done:false}); localStorage.setItem('tasks', JSON.stringify(STATE.data.tasks)); document.getElementById('new-task').value=''; app.renderTasks(); }
        },
        saveNotes: async () => {
            await utils.api('saveStudentNote', {token:STATE.token, text:document.getElementById('my-notes').value});
            Swal.fire({toast:true, position:'top-end', icon:'success', title:'ØªÙ… Ø§Ù„Ø­ÙØ¸', timer:1500, showConfirmButton:false});
        },
        upload: async () => {
            if(!STATE.tmp.file) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡','Ø§Ø®ØªØ± Ù…Ù„Ù','warning');
            utils.loader(1);
            let r = await utils.api('uploadStudentAssignment', {
                token:STATE.token, d:{type:document.getElementById('as-type').value, desc:document.getElementById('as-desc').value, fileData:STATE.tmp.file.d, fileName:STATE.tmp.file.n}
            });
            utils.loader(0);
            if(r.success) Swal.fire('Ù†Ø¬Ø§Ø­','ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„','success'); else Swal.fire('Ø®Ø·Ø£',r.message,'error');
        },
        renderHist: (l) => {
            let h='';
            l.forEach(x => {
                let p = x.percent>=50;
                h += `<div class="list-item">
                        <div class="list-icon ${p?'text-success':'text-danger'} font-bold">${x.percent}%</div>
                        <div class="list-content">
                            <h4>${x.exam}</h4>
                            <p>${p?'Ù†Ø§Ø¬Ø­':'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'}</p>
                        </div>
                      </div>`;
            });
            document.getElementById('history-list').innerHTML = h;
        },
        renderChart: (m, c) => {
            new Chart(document.getElementById('chart-canvas'), {
                type: 'line',
                data: { labels: ['Ø§Ù„Ø£ÙˆÙ„', 'Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ø§Ù„Ø«Ø§Ù„Ø«', 'Ø§Ù„Ø­Ø§Ù„ÙŠ'], datasets: [{label: 'Ù…Ø³ØªÙˆØ§Ùƒ', data: [m-5, m-2, m, m], borderColor: '#6366f1', fill:true, backgroundColor:'rgba(99,102,241,0.1)'}] },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true, max:100}} }
            });
        },
        pomoStart: () => {
            if(STATE.pomo.active) return;
            STATE.pomo.active = true;
            STATE.pomo.timer = setInterval(() => {
                STATE.pomo.sec--;
                let m = Math.floor(STATE.pomo.sec / 60);
                let s = STATE.pomo.sec % 60;
                document.getElementById('pomo-display').innerText = `${m}:${s<10?'0'+s:s}`;
                if(STATE.pomo.sec <= 0) {
                    clearInterval(STATE.pomo.timer);
                    STATE.pomo.active = false;
                    Swal.fire({title:'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!', icon:'info'});
                }
            }, 1000);
        },
        pomoReset: () => {
            clearInterval(STATE.pomo.timer);
            STATE.pomo.active = false;
            STATE.pomo.sec = 1500;
            document.getElementById('pomo-display').innerText = "25:00";
        }
    };

    // ==================== EXAM ENGINE ====================
    const exam = {
        start: async (t) => {
            utils.loader(1);
            let r = await utils.api('getExamQuestions', {token:STATE.token, name:t});
            utils.loader(0);
            if(!r.success) return Swal.fire('Ø®Ø·Ø£', 'ØªØ¹Ø°Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†', 'error');
            STATE.exam = { on:true, data:r.questions, ans:{}, idx:0, time:null, sec:r.duration*60, title:t };
            document.getElementById('exam-overlay').classList.remove('hidden');
            exam.render(); exam.timer();
        },
        render: () => {
            let q = STATE.exam.data[STATE.exam.idx];
            document.getElementById('ex-title').innerText = STATE.exam.title;
            document.getElementById('q-idx').innerText = STATE.exam.idx+1;
            document.getElementById('q-total').innerText = STATE.exam.data.length;
            document.getElementById('q-txt').innerText = q.text;
            document.getElementById('q-img').innerHTML = q.img ? `<img src="${q.img}" style="max-width:100%; border-radius:10px">` : '';
            
            let p = ((STATE.exam.idx+1)/STATE.exam.data.length)*100;
            document.getElementById('ex-prog').style.width = p+'%';
            
            let h=''; q.opts.forEach(o => {
                let s = STATE.exam.ans[q.id]==o ? 'border-primary bg-primary-alpha' : 'border-transparent bg-surface-2';
                h += `<div class="p-3 rounded-lg border cursor-pointer ${s} flex items-center gap-3 mb-2" onclick="exam.sel('${q.id}', '${o}')">
                        <div class="w-4 h-4 rounded-full border border-muted flex-center ${STATE.exam.ans[q.id]==o?'bg-primary border-primary':''}"></div>
                        <span class="text-sm font-bold">${o}</span>
                      </div>`;
            });
            document.getElementById('q-opts').innerHTML = h;
            document.getElementById('btn-next').innerText = STATE.exam.idx < STATE.exam.data.length-1 ? 'Ø§Ù„ØªØ§Ù„ÙŠ' : 'ØªØ³Ù„ÙŠÙ…';
        },
        sel: (qid, v) => { STATE.exam.ans[qid]=v; exam.render(); },
        nav: (d) => {
            let n = STATE.exam.idx + d;
            if(n >= 0 && n < STATE.exam.data.length) { STATE.exam.idx = n; exam.render(); }
            else if(d==1) exam.submit();
        },
        timer: () => {
            clearInterval(STATE.exam.time);
            STATE.exam.time = setInterval(() => {
                STATE.exam.sec--;
                let m = Math.floor(STATE.exam.sec/60), s = STATE.exam.sec%60;
                document.getElementById('ex-timer').innerText = `${m}:${s<10?'0'+s:s}`;
                if(STATE.exam.sec<=0) exam.submit(true);
            }, 1000);
        },
        submit: async (f) => {
            if(!f && !confirm('ØªØ³Ù„ÙŠÙ… Ù†Ù‡Ø§Ø¦ÙŠØŸ')) return;
            clearInterval(STATE.exam.time); utils.loader(1);
            let r = await utils.api('submitExam', {token:STATE.token, n:STATE.exam.title, a:STATE.exam.ans, cheats:0});
            utils.loader(0);
            document.getElementById('exam-overlay').classList.add('hidden');
            let pass = r.percent>=50;
            Swal.fire({
                title: pass ? 'Ø£Ø­Ø³Ù†Øª!' : 'Ø­Ø¸Ø§Ù‹ Ø£ÙˆÙØ±',
                text: `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${r.percent}%`,
                icon: pass ? 'success' : 'error'
            }).then(() => { if(pass) confetti(); app.loadData(); });
        },
        quit: () => { if(confirm('Ø®Ø±ÙˆØ¬ØŸ Ø³ØªÙÙ‚Ø¯ Ø§Ù„ØªÙ‚Ø¯Ù…')) { clearInterval(STATE.exam.time); document.getElementById('exam-overlay').classList.add('hidden'); } }
    };
    function actions(){ return { updatePic: (i) => {
        if(i.files[0]) {
            let r = new FileReader();
            r.onload = e => {
                utils.loader(1);
                utils.api('updateProfile', {token:STATE.token, newPhoto:e.target.result}).then(res => {
                    utils.loader(0);
                    if(res.success) {
                        localStorage.setItem('ph', e.target.result); STATE.user.photo = e.target.result;
                        document.getElementById('profile-img').src = e.target.result;
                        Swal.fire('Ù†Ø¬Ø§Ø­','ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«','success');
                    }
                });
            }; r.readAsDataURL(i.files[0]);
        }
    }}}
    const actionsObj = { updatePic: (i) => { actions().updatePic(i); } };
    window.actions = {...auth, ...actionsObj};
</script>
</body>
</html>
